<!DOCTYPE html>
<html lang="zh-TW">
<head>
<link rel="icon" href="data:,">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´Â∞àÊ•≠Á∑¥ÁøíÁ≥ªÁµ±</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            padding: 10px;
            padding-bottom: 0;
            min-height: 100vh;
            margin-bottom: 120px;
            overflow-x: hidden;
        }
        
        .main-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 10px auto;
            margin-bottom: 130px;
            max-width: 95%;
            width: 100%;
            backdrop-filter: blur(10px);
            min-height: calc(100vh - 250px);
            padding-bottom: 40px;
        }
        
        .quiz-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .quiz-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .quiz-header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }
        
        .quiz-status {
            position: absolute;
            top: 10px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 3;
        }
        
        .quiz-status.active {
            background: #28a745;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .database-selector {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .database-selector.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(70%);
            position: relative;
        }
        
        .database-selector.disabled::after {
            content: 'üîí Ê∏¨È©óÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïÂàáÊèõÈ°åÂ∫´';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 10;
        }
        
        .database-card {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .database-card:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-3px);
        }
        
        .database-card.selected {
            background: rgba(255, 255, 255, 0.4);
            border-color: #fff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .quiz-container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin: 20px;
            margin-bottom: 40px;
        }
        
        /* Ë®àÊôÇÂô®Ê®£Âºè - Á¢∫‰øùÂú®Ê∏¨È©ó‰∏≠È°ØÁ§∫ */
        .quiz-timer-display {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
            color: white;
            padding: 15px 20px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1050;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            min-width: 200px;
            text-align: center;
        }
        
        .quiz-timer-display.warning {
            background: linear-gradient(135deg, #dc3545, #c82333);
            animation: blink 1s infinite;
            border-color: #dc3545;
        }
        
        .option-label {
            display: block;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.4s ease;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            position: relative;
            overflow: hidden;
        }
        
        .option-label::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .option-label:hover {
            background: linear-gradient(145deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
        }
        
        .option-label:hover::before {
            left: 100%;
        }
        
        .option-input:checked + .option-label {
            background: linear-gradient(145deg, #c8e6c9, #a5d6a7);
            border-color: #4caf50;
            color: #2e7d32;
            font-weight: bold;
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }
        
        .option-input:checked + .option-label::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: #4caf50;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            animation: checkmark 0.3s ease-in-out;
        }
        
        @keyframes checkmark {
            0% { transform: translateY(-50%) scale(0); }
            50% { transform: translateY(-50%) scale(1.2); }
            100% { transform: translateY(-50%) scale(1); }
        }
        
        .option-input {
            display: none;
        }
        
        .explanation-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid #007bff;
            padding: 25px;
            margin-top: 20px;
            border-radius: 12px;
            min-height: 150px;
            max-height: 500px;
            overflow-y: auto;
            word-wrap: break-word;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .explanation-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .explanation-box::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }
        
        .explanation-box::-webkit-scrollbar-thumb {
            background: #007bff;
            border-radius: 5px;
        }
        
        .explanation-box::-webkit-scrollbar-thumb:hover {
            background: #0056b3;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(248, 249, 250, 0.98));
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1040;
            padding: 20px 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            border-radius: 12px;
            font-weight: 600;
            padding: 12px 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: none;
            font-size: 0.85rem;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .progress {
            height: 12px;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.5s ease;
        }
        
        .badge-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-size: 0.9rem;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
        }
        
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #FF5722;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
        }
        
        .timer.exam-mode {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            color: #1976d2;
            animation: pulse-exam 2s infinite;
        }
        
        @keyframes pulse-exam {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .timer.warning {
            color: #dc3545;
            animation: blink 1s infinite;
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #dc3545;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .correct {
            color: #198754;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .incorrect {
            color: #dc3545;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .highlight {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 1rem;
            line-height: 1.6;
            border-left: 4px solid #ffc107;
        }
        
        .nav-brand {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white !important;
            font-weight: bold;
            border-radius: 10px;
            padding: 8px 16px !important;
        }
        
        .settings-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .settings-panel.disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .mode-btn {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            font-weight: 600;
        }
        
        .mode-btn:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .back-to-selection {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .back-to-selection:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }
        
        .loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #fff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Ë§áÁøíÊ®°ÂºèÈÅ∏ÊìáÊ®£Âºè */
        .review-modes {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        .review-mode-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 10px 15px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .review-mode-item:hover {
            background: rgba(40, 167, 69, 0.1);
            transform: translateX(5px);
        }

        .review-mode-item.selected {
            background: #28a745;
            color: white;
        }
        
        /* ËÄÉË©¶Ë¶èÁØÑË≥áË®ä */
        .exam-specs {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .exam-specs.ipas {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-color: #2196f3;
        }
        
        .exam-specs.iii {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-color: #4caf50;
        }
        /* Êñ∞Â¢ûÔºöÊ®ôË®òËàá‰øÆÊîπÁ≠îÊ°àÊåâÈàï */
        .mark-review-btn {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #495057;
        }
        .mark-review-btn.active {
            background-color: #ffc107;
            border-color: #f5b400;
            color: #fff;
            font-weight: bold;
        }
        .modify-answer-btn {
            background-color: #ffc107;
            color: #333;
        }
        
        /* Êñ∞Â¢ûÔºöÈ°åËôüÁ∏ΩË¶ΩÊ®°ÊÖãÊ°ÜÊ®£Âºè */
        #overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
        }
        .overview-q-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #dee2e6;
            background-color: #f8f9fa;
            color: #495057;
            font-weight: bold;
            position: relative;
            transition: all 0.2s ease;
        }
        .overview-q-btn.answered {
            background-color: #d1e7dd;
            border-color: #a3cfbb;
            color: #0f5132;
        }
        .overview-q-btn.current {
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
            transform: scale(1.1);
        }
        .overview-q-btn.marked .fa-flag {
            display: block;
        }
        .overview-q-btn .fa-flag {
            position: absolute;
            top: 4px;
            right: 4px;
            color: #ffc107;
            font-size: 0.7em;
            display: none;
        }
        
        
        @media (max-width: 768px) {
            body {
                margin-bottom: 130px;
            }
            
            .main-container {
                margin: 5px auto;
                margin-bottom: 140px;
                border-radius: 15px;
                max-width: 98%;
                padding-bottom: 50px;
            }
            
            .quiz-header {
                padding: 15px;
                border-radius: 15px 15px 0 0;
            }
            
            .database-selector, .quiz-container, .settings-panel {
                margin: 10px;
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .database-card {
                padding: 15px;
                margin: 8px 0;
            }
            
            .quiz-timer-display {
                position: fixed;
                top: 70px;
                right: 10px;
                font-size: 1rem;
                padding: 10px 15px;
                min-width: 160px;
            }
/* üî• ‰ªòË≤ªÂçáÁ¥öÂäüËÉΩ CSS START */
.btn-gradient-premium {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    border: none;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
    transition: all 0.3s;
}

.btn-gradient-premium:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(240, 147, 251, 0.6);
    color: white;
}

.bg-gradient-premium {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.badge.paid-member {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
}

.ribbon {
    position: absolute;
    right: -5px;
    top: -5px;
    z-index: 1;
    overflow: hidden;
    width: 75px;
    height: 75px;
    text-align: right;
}

.ribbon span {
    font-size: 10px;
    font-weight: bold;
    color: #FFF;
    text-transform: uppercase;
    text-align: center;
    line-height: 20px;
    transform: rotate(45deg);
    width: 100px;
    display: block;
    background: linear-gradient(#f5576c 0%, #f093fb 100%);
    box-shadow: 0 3px 10px -5px rgba(0, 0, 0, 1);
    position: absolute;
    top: 19px;
    right: -21px;
}

.feature-item {
    padding: 8px;
    background: #f8f9fa;
    border-radius: 8px;
    font-size: 0.9rem;
}

.price-tag {
    background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
    padding: 20px;
    border-radius: 15px;
}

.pricing-card {
    transition: all 0.3s;
}

.pricing-card:hover {
    transform: translateY(-5px);
}

.recommended-card {
    transform: scale(1.05);
    border: 3px solid #f5576c !important;
}

.locked-feature {
    opacity: 0.7;
    position: relative;
    cursor: not-allowed;
}

.locked-feature::after {
    content: '\f023';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.5rem;
    color: #f5576c;
}
/* üî• ‰ªòË≤ªÂçáÁ¥öÂäüËÉΩ CSS END */

            
        }
    </style>

    <script>
        // ËºâÂÖ•È°åÂ∫´Ë≥áÊñô
        let quizData = {
            'generative-ai': [],
            'ipas': [],
            'ai-basis': [],
            'ai-application': [],
            'ipas-combined': []
        };

        async function loadQuizDatabases() {
            try {
                console.log('üîç ÈñãÂßãËºâÂÖ•È°åÂ∫´...');
                
                // ËºâÂÖ•ÁîüÊàêÂºèAIÈ°åÂ∫´
                try {
                    const response1 = await fetch('./Ê®°Êì¨ËÄÉÈ°å.json');
                    if (response1.ok) {
                        const data1 = await response1.json();
                        if (Array.isArray(data1) && data1.length > 0) {
                            quizData['generative-ai'] = data1;
                            console.log('‚úÖ ÁîüÊàêÂºèAIÈ°åÂ∫´Â∑≤ËºâÂÖ•:', quizData['generative-ai'].length + 'È°å');
                        } else {
                            throw new Error('È°åÂ∫´Ê†ºÂºèÈåØË™§ÊàñÁÇ∫Á©∫');
                        }
                    } else {
                        throw new Error(`HTTP ${response1.status}`);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è ÁîüÊàêÂºèAIÈ°åÂ∫´ËºâÂÖ•Â§±Êïó:', error.message);
                    quizData['generative-ai'] = [];
                }
                
                // ËºâÂÖ•‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñÈ°åÂ∫´ (daily_answers_apply.json)
                try {
                    const response2 = await fetch('./daily_answers_apply.json');
                    if (response2.ok) {
                        const data2 = await response2.json();
                        if (Array.isArray(data2) && data2.length > 0) {
                            quizData['ai-basis'] = data2;
                            console.log('‚úÖ ‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñÈ°åÂ∫´Â∑≤ËºâÂÖ•:', quizData['ai-basis'].length + 'È°å');
                        } else {
                            throw new Error('È°åÂ∫´Ê†ºÂºèÈåØË™§ÊàñÁÇ∫Á©∫');
                        }
                    } else {
                        throw new Error(`HTTP ${response2.status}`);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è ‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñÈ°åÂ∫´ËºâÂÖ•Â§±Êïó:', error.message);
                    quizData['ai-basis'] = [];
                }
                
                // ËºâÂÖ•ÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉÈ°åÂ∫´ (daily_answers_basis.json)
                try {
                    const response3 = await fetch('./daily_answers_basis.json');
                    if (response3.ok) {
                        const data3 = await response3.json();
                        if (Array.isArray(data3) && data3.length > 0) {
                            quizData['ai-application'] = data3;
                            console.log('‚úÖ ÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉÈ°åÂ∫´Â∑≤ËºâÂÖ•:', quizData['ai-application'].length + 'È°å');
                        } else {
                            throw new Error('È°åÂ∫´Ê†ºÂºèÈåØË™§ÊàñÁÇ∫Á©∫');
                        }
                    } else {
                        throw new Error(`HTTP ${response3.status}`);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è ÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉÈ°åÂ∫´ËºâÂÖ•Â§±Êïó:', error.message);
                    quizData['ai-application'] = [];
                }
                
                // ËºâÂÖ•ÂéüiPASÈ°åÂ∫´ (‰øùÊåÅÂêëÂæåÂÖºÂÆπ)
                try {
                    const response4 = await fetch('./ÊáâÁî®Ê®°Êì¨ËÄÉÈ°å.json');
                    if (response4.ok) {
                        const data4 = await response4.json();
                        if (Array.isArray(data4) && data4.length > 0) {
                            quizData['ipas'] = data4;
                            console.log('‚úÖ ÂéüiPASÈ°åÂ∫´Â∑≤ËºâÂÖ•:', quizData['ipas'].length + 'È°å');
                        } else {
                            throw new Error('È°åÂ∫´Ê†ºÂºèÈåØË™§ÊàñÁÇ∫Á©∫');
                        }
                    } else {
                        throw new Error(`HTTP ${response4.status}`);
                    }
                } catch (error) {
                    console.warn('‚ö†Ô∏è ÂéüiPASÈ°åÂ∫´ËºâÂÖ•Â§±Êïó:', error.message);
                    quizData['ipas'] = [];
                }
                
                // Âª∫Á´ãÁ∂úÂêàËÄÉÈ°å (Âêà‰ΩµÂÖ©ÂÄãÊñ∞È°åÂ∫´)
                if (quizData['ai-basis'].length > 0 || quizData['ai-application'].length > 0) {
                    quizData['ipas-combined'] = [...quizData['ai-basis'], ...quizData['ai-application']];
                    console.log('‚úÖ Á∂úÂêàËÄÉÈ°åÂ∑≤Âª∫Á´ã:', quizData['ipas-combined'].length + 'È°å');
                }
                
                // Ê™¢Êü•ÊòØÂê¶ÈúÄË¶ÅÁîüÊàêÁ§∫‰æãÊï∏Êìö
                if (quizData['ipas'].length === 0 && quizData['generative-ai'].length === 0) {
                    console.log('üìù ÂÖ©ÂÄãÈ°åÂ∫´ÈÉΩËºâÂÖ•Â§±ÊïóÔºåÁîüÊàêÁ§∫‰æãÈ°åÂ∫´...');
                    quizData['ipas'] = generateSampleQuestions();
                    quizData['generative-ai'] = generateSampleAIQuestions();
                    
                    // È°ØÁ§∫ÊèêÁ§∫Ë®äÊÅØ
                    setTimeout(() => {
                        if (typeof iPASQuizApp !== 'undefined' && iPASQuizApp.showAlert) {
                            iPASQuizApp.showAlert('È°åÂ∫´Ê™îÊ°àÊú™ÊâæÂà∞ÔºåÂ∑≤ËºâÂÖ•Á§∫‰æãÈ°åÁõÆ‰æõÊ∏¨Ë©¶ÔºÅ\nË´ãÁ¢∫‰øù Ê®°Êì¨ËÄÉÈ°å.json Âíå ÊáâÁî®Ê®°Êì¨ËÄÉÈ°å.json Âú®Ê≠£Á¢∫‰ΩçÁΩÆ„ÄÇ', 'warning');
                        } else {
                            alert('È°åÂ∫´Ê™îÊ°àÊú™ÊâæÂà∞ÔºåÂ∑≤ËºâÂÖ•Á§∫‰æãÈ°åÁõÆ‰æõÊ∏¨Ë©¶ÔºÅ\nË´ãÁ¢∫‰øù Ê®°Êì¨ËÄÉÈ°å.json Âíå ÊáâÁî®Ê®°Êì¨ËÄÉÈ°å.json Âú®Ê≠£Á¢∫‰ΩçÁΩÆ„ÄÇ');
                        }
                    }, 1000);
                } else if (quizData['ipas'].length === 0) {
                    console.log('üìù iPASÈ°åÂ∫´ËºâÂÖ•Â§±ÊïóÔºåÁîüÊàêÁ§∫‰æãiPASÈ°åÂ∫´...');
                    quizData['ipas'] = generateSampleQuestions();
                } else if (quizData['generative-ai'].length === 0) {
                    console.log('üìù ÁîüÊàêÂºèAIÈ°åÂ∫´ËºâÂÖ•Â§±ÊïóÔºåÁîüÊàêÁ§∫‰æãAIÈ°åÂ∫´...');
                    quizData['generative-ai'] = generateSampleAIQuestions();
                }
                
                console.log('üìö È°åÂ∫´ËºâÂÖ•ÂÆåÊàê');
                console.log('üìä ËºâÂÖ•ÁãÄÊÖã:', {
                    'iPASÈ°åÂ∫´': quizData['ipas'].length + 'È°å',
                    'ÁîüÊàêÂºèAIÈ°åÂ∫´': quizData['generative-ai'].length + 'È°å'
                });
                
            } catch (error) {
                console.error('‚ùå È°åÂ∫´ËºâÂÖ•ÁôºÁîüÂö¥ÈáçÈåØË™§:', error);
                // Á¢∫‰øùËá≥Â∞ëÊúâ‰∏Ä‰∫õÈ°åÁõÆÂèØÁî®
                quizData['ipas'] = generateSampleQuestions();
                quizData['generative-ai'] = generateSampleAIQuestions();
                
                setTimeout(() => {
                    if (typeof iPASQuizApp !== 'undefined' && iPASQuizApp.showAlert) {
                        iPASQuizApp.showAlert('È°åÂ∫´ËºâÂÖ•Â§±ÊïóÔºåÂ∑≤ËºâÂÖ•Á§∫‰æãÈ°åÁõÆÔºÅ', 'error');
                    } else {
                        alert('È°åÂ∫´ËºâÂÖ•Â§±ÊïóÔºåÂ∑≤ËºâÂÖ•Á§∫‰æãÈ°åÁõÆÔºÅ');
                    }
                }, 1000);
            }
        }

        // ÁîüÊàêÁ§∫‰æãiPASÈ°åÁõÆ
        function generateSampleQuestions() {
            return [
                {
                    question: "Ê†πÊìöÁ∂ìÊøüÈÉ®iPASË™çË≠âÊ®ôÊ∫ñÔºåAIÊáâÁî®Ë¶èÂäÉÂ∏´ÈúÄË¶ÅÂÖ∑ÂÇôÂì™È†ÖÊ†∏ÂøÉËÉΩÂäõÔºü",
                    options: [
                        "Á®ãÂºèË®≠Ë®àËàáÊºîÁÆóÊ≥ïÈñãÁôº",
                        "AIÊäÄË°ìÊáâÁî®ËàáÂïÜÊ•≠ÂÉπÂÄºË©ï‰º∞",
                        "Á°¨È´îË®≠ÂÇôÁ∂≠Ë≠∑ËàáÁÆ°ÁêÜ",
                        "Ë≥áÊñôÂ∫´ÁÆ°ÁêÜËàáÁ∂≤Ë∑ØÂÆâÂÖ®"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "AIÊáâÁî®Ë¶èÂäÉÂ∏´‰∏ªË¶ÅË≤†Ë≤¨Ë©ï‰º∞AIÊäÄË°ìÁöÑÂïÜÊ•≠ÊáâÁî®ÂÉπÂÄºÔºåË¶èÂäÉAIÂ∞àÊ°àÁöÑÂØ¶ÊñΩÁ≠ñÁï•ÔºåËÄåÈùûÁ¥îÊäÄË°ìÈñãÁôºÂ∑•‰Ωú„ÄÇ",
                    topic: "AIÊáâÁî®Ë¶èÂäÉ",
                    subtopic: "Ê†∏ÂøÉËÉΩÂäõ"
                },
                {
                    question: "Âú®AIÂ∞àÊ°àË¶èÂäÉÈöéÊÆµÔºå‰ª•‰∏ãÂì™ÂÄãÊ≠•È©üÊúÄÁÇ∫ÈáçË¶ÅÔºü",
                    options: [
                        "ÈÅ∏ÊìáÊúÄÂÖàÈÄ≤ÁöÑAIÊäÄË°ì",
                        "Á¢∫‰øùÂÖÖË∂≥ÁöÑÁ°¨È´îË≥áÊ∫ê",
                        "ÊòéÁ¢∫ÂÆöÁæ©ÂïèÈ°åËàáÁõÆÊ®ô",
                        "ÊãõÂãüÊõ¥Â§öÊäÄË°ì‰∫∫Âì°"
                    ],
                    correct_answer_letter: "C",
                    correct_answer_index: 2,
                    explanation: "ÊòéÁ¢∫ÂÆöÁæ©ÂïèÈ°åËàáÁõÆÊ®ôÊòØAIÂ∞àÊ°àÊàêÂäüÁöÑÂü∫Á§éÔºåÂè™ÊúâÊ∏ÖÊ•ö‰∫ÜËß£Ë¶ÅËß£Ê±∫‰ªÄÈ∫ºÂïèÈ°åÔºåÊâçËÉΩÈÅ∏ÊìáÈÅ©ÂêàÁöÑÊäÄË°ìÊñπÊ°à„ÄÇ",
                    topic: "Â∞àÊ°àÁÆ°ÁêÜ",
                    subtopic: "ÈúÄÊ±ÇÂàÜÊûê"
                },
                {
                    question: "Ê©üÂô®Â≠∏ÁøíÊ®°ÂûãÁöÑ„ÄåÈÅéÂ∫¶Êì¨Âêà„Äç(Overfitting)ÊúÉÂ∞éËá¥‰ªÄÈ∫ºÂïèÈ°åÔºü",
                    options: [
                        "Ë®ìÁ∑¥ÊôÇÈñìÈÅéÈï∑",
                        "Ê®°ÂûãÂú®Êñ∞Ë≥áÊñô‰∏äË°®Áèæ‰∏ç‰Ω≥",
                        "Ë®òÊÜ∂È´î‰ΩøÁî®ÈÅéÂ§ö",
                        "Ë®àÁÆóÊàêÊú¨ÈÅéÈ´ò"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "ÈÅéÂ∫¶Êì¨ÂêàÊåáÊ®°ÂûãÈÅéÂ∫¶Â≠∏ÁøíË®ìÁ∑¥Ë≥áÊñôÁöÑÁ¥∞ÁØÄÔºåÂ∞éËá¥Âú®Êú™Ë¶ãÈÅéÁöÑÊñ∞Ë≥áÊñô‰∏äÊ≥õÂåñËÉΩÂäõÂ∑ÆÔºåÈ†êÊ∏¨Ê∫ñÁ¢∫ÊÄß‰∏ãÈôç„ÄÇ",
                    topic: "Ê©üÂô®Â≠∏Áøí",
                    subtopic: "Ê®°ÂûãË©ï‰º∞"
                },
                {
                    question: "AIÂ∞àÊ°àÁöÑROIÔºàÊäïË≥áÂ†±ÈÖ¨ÁéáÔºâË©ï‰º∞ÊáâË©≤ËÄÉÊÖÆÂì™‰∫õ‰∏ªË¶ÅÂõ†Á¥†Ôºü",
                    options: [
                        "Âè™ËÄÉÊÖÆÊäÄË°ìÈñãÁôºÊàêÊú¨",
                        "ÊäÄË°ìÊàêÊú¨„ÄÅ‰∫∫ÂäõÊàêÊú¨„ÄÅÁ∂≠Ë≠∑ÊàêÊú¨ËàáÈ†êÊúüÊïàÁõä",
                        "Âè™ËÄÉÊÖÆËªüÈ´îÊéàÊ¨äË≤ªÁî®",
                        "Âè™ËÄÉÊÖÆÁ°¨È´îÊé°Ë≥ºÊàêÊú¨"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "ÂÆåÊï¥ÁöÑROIË©ï‰º∞ÈúÄË¶ÅËÄÉÊÖÆÊâÄÊúâÁõ∏ÈóúÊàêÊú¨ÔºàÊäÄË°ì„ÄÅ‰∫∫Âäõ„ÄÅÁ∂≠Ë≠∑Ôºâ‰ª•ÂèäÈ†êÊúüÁöÑÂïÜÊ•≠ÊïàÁõäÔºåÊâçËÉΩÂÅöÂá∫Ê≠£Á¢∫ÁöÑÊäïË≥áÊ±∫Á≠ñ„ÄÇ",
                    topic: "ÂïÜÊ•≠ÂàÜÊûê",
                    subtopic: "ÊàêÊú¨ÊïàÁõäÂàÜÊûê"
                },
                {
                    question: "Âú®AIÂ∞àÊ°à‰∏≠ÔºåË≥áÊñôÊ≤ªÁêÜÔºàData GovernanceÔºâÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰ªÄÈ∫ºÔºü",
                    options: [
                        "Â¢ûÂä†Ë≥áÊñôÁöÑÊï∏Èáè",
                        "Á¢∫‰øùË≥áÊñôÁöÑÂìÅË≥™„ÄÅÂÆâÂÖ®ÊÄßÂíåÂêàË¶èÊÄß",
                        "Ê∏õÂ∞ëË≥áÊñôÁöÑÂÑ≤Â≠òÊàêÊú¨",
                        "Âä†Âø´Ë≥áÊñôÁöÑËôïÁêÜÈÄüÂ∫¶"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "Ë≥áÊñôÊ≤ªÁêÜÁöÑÊ†∏ÂøÉÊòØÂª∫Á´ãÊ°ÜÊû∂‰æÜÁÆ°ÁêÜË≥áÊñôÁöÑÂìÅË≥™„ÄÅÂÆâÂÖ®ÊÄß„ÄÅÈö±ÁßÅ‰øùË≠∑ÂíåÊ≥ïË¶èÈÅµÂæ™ÔºåÁ¢∫‰øùAIÂ∞àÊ°à‰ΩøÁî®È´òÂìÅË≥™‰∏îÂêàË¶èÁöÑË≥áÊñô„ÄÇ",
                    topic: "Ë≥áÊñôÁÆ°ÁêÜ",
                    subtopic: "Ë≥áÊñôÊ≤ªÁêÜ"
                }
            ];
        }

        // ÁîüÊàêÁ§∫‰æãÁîüÊàêÂºèAIÈ°åÁõÆ
        function generateSampleAIQuestions() {
            return [
                {
                    question: "ÁîüÊàêÂºèAIÁöÑ‰∏ªË¶ÅÁâπÂæµÊòØ‰ªÄÈ∫ºÔºü",
                    options: [
                        "Âè™ËÉΩÂàÜÊûêÁèæÊúâË≥áÊñô",
                        "ËÉΩÂ§†ÂâµÈÄ†Êñ∞ÁöÑÂÖßÂÆπÊàñË≥áÊñô",
                        "Âè™ËÉΩËôïÁêÜÊï∏ÂÄºÂûãË≥áÊñô",
                        "Âè™ËÉΩÂü∑Ë°åÂàÜÈ°û‰ªªÂãô"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "ÁîüÊàêÂºèAIÁöÑÊ†∏ÂøÉÁâπÂæµÊòØËÉΩÂ§†Â≠∏ÁøíË≥áÊñôÁöÑÂàÜÂ∏É‰∏¶ÁîüÊàêÊñ∞ÁöÑ„ÄÅÈ°û‰ººÁöÑÂÖßÂÆπÔºåÂ¶ÇÊñáÂ≠ó„ÄÅÂúñÂÉè„ÄÅÈü≥Ê®ÇÁ≠â„ÄÇ",
                    topic: "ÁîüÊàêÂºèAIÂü∫Á§é",
                    subtopic: "Âü∫Êú¨Ê¶ÇÂøµ"
                },
                {
                    question: "GPTÊ®°Âûã‰∏≠ÁöÑ'T'‰ª£Ë°®‰ªÄÈ∫ºÔºü",
                    options: [
                        "TrainingÔºàË®ìÁ∑¥Ôºâ",
                        "TransformerÔºàËΩâÊèõÂô®Ôºâ",
                        "TestingÔºàÊ∏¨Ë©¶Ôºâ",
                        "TechnologyÔºàÊäÄË°ìÔºâ"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "GPT‰ª£Ë°®Generative Pre-trained TransformerÔºåÂÖ∂‰∏≠TÊåáÁöÑÊòØTransformerÊû∂ÊßãÔºåÈÄôÊòØGPTÊ®°ÂûãÁöÑÊ†∏ÂøÉÊäÄË°ìÂü∫Á§é„ÄÇ",
                    topic: "Â§ßÂûãË™ûË®ÄÊ®°Âûã",
                    subtopic: "GPTÁ≥ªÂàó"
                },
                {
                    question: "Prompt EngineeringÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØ‰ªÄÈ∫ºÔºü",
                    options: [
                        "ÊèêÈ´òÊ®°ÂûãÁöÑÈÅãÁÆóÈÄüÂ∫¶",
                        "ÂÑ™ÂåñËº∏ÂÖ•Êåá‰ª§‰ª•Áç≤ÂæóÊõ¥Â•ΩÁöÑËº∏Âá∫ÁµêÊûú",
                        "Ê∏õÂ∞ëÊ®°ÂûãÁöÑÂèÉÊï∏Êï∏Èáè",
                        "Èôç‰ΩéÊ®°ÂûãÁöÑË®òÊÜ∂È´î‰ΩøÁî®"
                    ],
                    correct_answer_letter: "B",
                    correct_answer_index: 1,
                    explanation: "Prompt EngineeringÊòØË®≠Ë®àÂíåÂÑ™ÂåñËº∏ÂÖ•ÊèêÁ§∫Ë©ûÁöÑÊäÄË°ìÔºåÁõÆÁöÑÊòØÂºïÂ∞éAIÊ®°ÂûãÁî¢ÁîüÊõ¥Ê∫ñÁ¢∫„ÄÅÊõ¥Á¨¶ÂêàÈúÄÊ±ÇÁöÑÂõûÊáâ„ÄÇ",
                    topic: "ÊèêÁ§∫Â∑•Á®ã",
                    subtopic: "Âü∫Êú¨ÂéüÁêÜ"
                }
            ];
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇËá™ÂãïËºâÂÖ•È°åÂ∫´
        document.addEventListener('DOMContentLoaded', loadQuizDatabases);
    </script>
</head>
<body>
    <!-- È†ÇÈÉ®Â∞éËà™ -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand nav-brand" href="#">
                <i class="fas fa-graduation-cap me-2"></i>iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    
    <!-- ‚ú® Êñ∞Â¢ûÔºöÁôªÂÖ•ÂçÄÂ°ä START -->
    <li class="nav-item" id="login-nav-item">
        <a class="nav-link" href="#" id="nav-login-btn">
            <i class="fas fa-sign-in-alt me-1"></i>ÁôªÂÖ•
        </a>
    </li>
                    
<!-- üî• Êñ∞Â¢û:Â∞éËà™Ê¨ÑÂçáÁ¥öÊåâÈàï (ÂÖçË≤ªÊúÉÂì°ÂèØË¶ã) -->
<li class="nav-item" id="nav-upgrade-item" style="display: none;">
    <a class="nav-link text-warning fw-bold" href="#" onclick="openUpgradeModal(); return false;">
        <i class="fas fa-crown me-1"></i>ÂçáÁ¥ö VIP
    </a>
</li>

                    
    <li class="nav-item d-none" id="user-nav-item">
        <div class="d-flex align-items-center">
            <img id="nav-user-avatar" src="" class="rounded-circle me-2" width="32" height="32" alt="È†≠ÂÉè">
            <span id="nav-user-name" class="text-dark me-3"></span>
            <a class="nav-link" href="#" id="nav-logout-btn">
                <i class="fas fa-sign-out-alt me-1"></i>ÁôªÂá∫
            </a>
        </div>
    </li>
    <!-- ‚ú® Êñ∞Â¢ûÔºöÁôªÂÖ•ÂçÄÂ°ä END -->
                    
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="save-btn">
                            <i class="fas fa-save me-1"></i>ÂÑ≤Â≠òÈÄ≤Â∫¶
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="export-btn">
                            <i class="fas fa-download me-1"></i>ÂåØÂá∫ÈåØÈ°å
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="stats-btn">
                            <i class="fas fa-chart-bar me-1"></i>Â≠∏ÁøíÁµ±Ë®à
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="help-btn">
                            <i class="fas fa-question-circle me-1"></i>‰ΩøÁî®Ë™™Êòé
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div style="height: 70px;"></div> <!-- Â∞éËà™Ê¨ÑÈñìË∑ù -->

    <div class="main-container">
        <!-- Ê∏¨È©óÁãÄÊÖãÊåáÁ§∫Âô® -->
        <div id="quiz-status" class="quiz-status" style="display: none;">
            <i class="fas fa-lock me-1"></i>Ê∏¨È©óÈÄ≤Ë°å‰∏≠
        </div>
        
        <div class="quiz-header">
            <h1><i class="fas fa-brain me-3"></i>iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´Â∞àÊ•≠Á∑¥ÁøíÁ≥ªÁµ±</h1>
            <p class="mb-0">Á∂ìÊøüÈÉ®Áî¢Ê•≠‰∫∫ÊâçËÉΩÂäõÈëëÂÆö - ËÄÉË©¶Ë°ùÂà∫Â∞àÁî®</p>
        </div>
         <!-- ‚ú® Êñ∞Â¢ûÔºöÊúÉÂì°ÁôªÂÖ•ÂçÄÂ°ä START -->
    <div class="login-section" id="login-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 30px; margin: 20px; text-align: center;">
        <h4 class="text-white mb-4">
            <i class="fas fa-user-circle me-2"></i>ÊúÉÂì°Â∞àÂ±¨ÂäüËÉΩ
        </h4>
        <p class="text-white mb-4">ÁôªÂÖ•ÂæåÂç≥ÂèØÈõ≤Á´ØÂêåÊ≠•Â≠∏ÁøíÈÄ≤Â∫¶„ÄÅÊü•ÁúãÊéíË°åÊ¶ú„ÄÅÊé•Êî∂ Line ÊØèÊó•Êé®Êí≠ÔºÅ</p>
        
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <button id="line-login-btn" class="btn btn-success btn-lg px-4">
                <i class="fab fa-line me-2"></i>‰ΩøÁî® Line ÁôªÂÖ•
            </button>
            <button id="google-login-btn" class="btn btn-light btn-lg px-4">
                <i class="fab fa-google me-2"></i>‰ΩøÁî® Google ÁôªÂÖ•
            </button>
        </div>
    </div>
    
    <!-- ÁôªÂÖ•ÂæåÈ°ØÁ§∫ÁöÑÂçÄÂ°ä -->
    <div class="user-welcome d-none" id="user-welcome" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); border-radius: 15px; padding: 25px; margin: 20px;">
        <div class="d-flex align-items-center justify-content-between flex-wrap">
            <div class="d-flex align-items-center">
                <img id="user-avatar" src="" alt="È†≠ÂÉè" class="rounded-circle me-3" width="60" height="60">
                <div>
                    <h5 class="mb-1">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        Ê≠°ËøéÂõû‰æÜÔºå<span id="user-name">ËºâÂÖ•‰∏≠...</span>ÔºÅ
                        <span id="user-level-badge" class="badge bg-primary ms-2" style="font-size: 0.8rem;">ËºâÂÖ•‰∏≠...</span>
                    </h5>
                    <small class="text-muted">
                        <i class="fas fa-calendar-alt me-1"></i>ÊúÄÂæåÁôªÂÖ•Ôºö<span id="last-login">ÂâõÂâõ</span>
                        <span class="ms-3"><i class="fas fa-sign-in-alt me-1"></i>ÁôªÂÖ•ÊñπÂºè: <span id="login-method">Line</span></span>
                    </small>
                </div>
            </div>
                    <div class="d-flex gap-2">
            <!-- üî• Êñ∞Â¢û:ÂçáÁ¥öÊåâÈàï (Â§ßÁâàÊú¨,Âè™Â∞çÂÖçË≤ªÊúÉÂì°È°ØÁ§∫) -->
            <button id="upgrade-btn-large" class="btn btn-warning" style="display: none;" onclick="openUpgradeModal()">
                <i class="fas fa-star me-2"></i>ÂçáÁ¥ö‰ªòË≤ªÊúÉÂì°
            </button>

            
            <button id="logout-btn" class="btn btn-outline-danger">
                <i class="fas fa-sign-out-alt me-2"></i>ÁôªÂá∫
            </button>
        </div>
    </div>

   <!-- üî• Êñ∞Â¢û:ÂÖçË≤ªÊúÉÂì°ÈôêÂà∂ÊèêÁ§∫Âç°Áâá -->
    <div id="free-member-notice" class="alert alert-warning mt-3" style="display: none;">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle me-3" style="font-size: 1.5rem;"></i>
            <div class="flex-grow-1">
                <h6 class="mb-2">
                    <strong>ÂÖçË≤ªÊúÉÂì°ÂäüËÉΩÈôêÂà∂</strong>
                </h6>
                <ul class="mb-2" style="font-size: 0.9rem;">
                    <li>‚ùå ÁÑ°Ê≥ï‰ΩøÁî®Ê®°Êì¨ËÄÉË©¶Ê®°Âºè</li>
                    <li>‚ùå ÁÑ°Ê≥ïÈõ≤Á´ØÂêåÊ≠•Â≠∏ÁøíÈÄ≤Â∫¶</li>
                    <li>‚ùå ÁÑ°Ê≥ïÂåØÂá∫ÈåØÈ°åÈõÜ</li>
                    <li>‚ùå Á§æÁæ§È°åÁõÆËß£ÊûêÈúÄÁ≠âÂà∞Êôö‰∏ä</li>
                </ul>
                <button class="btn btn-warning btn-sm" onclick="openUpgradeModal()">
                    <i class="fas fa-crown me-1"></i>Á´ãÂç≥ÂçáÁ¥öËß£ÈéñÂÖ®ÂäüËÉΩ
                </button>
            </div>
            <button class="btn-close" onclick="document.getElementById('free-member-notice').style.display='none'"></button>
        </div>
    </div>
</div>

        
    <!-- ‚ú® Êñ∞Â¢ûÔºöÊúÉÂì°ÁôªÂÖ•ÂçÄÂ°ä END -->
        
        <!-- È°åÂ∫´ÈÅ∏ÊìáÂçÄ -->
        <div class="database-selector" id="database-selector">
            <h3 class="mb-4"><i class="fas fa-database me-2"></i>ÈÅ∏ÊìáÁ∑¥ÁøíÈ°åÂ∫´</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="database-card" data-type="ipas">
                        <div class="text-center">
                            <i class="fas fa-star fa-3x mb-3" style="color: #ffd700;"></i>
                            <h5>iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´</h5>
                            <p class="mb-2">Á∂ìÊøüÈÉ®Áî¢Ê•≠‰∫∫ÊâçËÉΩÂäõÈëëÂÆö</p>
                            <small>‚≠ê ‰∏ªË¶ÅËÄÉË©¶È°åÂ∫´ - ÈáçÈªûÁ∑¥Áøí</small>
                        </div>
                        <div class="exam-specs ipas mt-3">
                            <strong>üìã ÂÆòÊñπËÄÉË©¶Ë¶èÁØÑÔºö</strong><br>
                            ‚Ä¢ Á∏ΩÈ°åÊï∏Ôºö100È°åÂñÆÈÅ∏È°å<br>
                            ‚Ä¢ ÁßëÁõÆ‰∏ÄÔºö‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñÔºàÁ¥Ñ50È°åÔºâ<br>
                            ‚Ä¢ ÁßëÁõÆ‰∫åÔºöÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉÔºàÁ¥Ñ50È°åÔºâ<br>
                            ‚Ä¢ ËÄÉË©¶ÊôÇÈñìÔºöÊØèÁßë75ÂàÜÈêòÔºàÁ∏ΩË®à150ÂàÜÈêòÔºâ<br>
                            ‚Ä¢ ÂèäÊ†ºÊ®ôÊ∫ñÔºöÂπ≥Âùá70ÂàÜÔºåÂñÆÁßë‰∏ç‰ΩéÊñº60ÂàÜ
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="database-card" data-type="generative-ai">
                        <div class="text-center">
                            <i class="fas fa-robot fa-3x mb-3"></i>
                            <h5>Ë≥áÁ≠ñÊúÉÁîüÊàêÂºèAIË™çË≠â</h5>
                            <p class="mb-2">Ë≥áÁ≠ñÊúÉÁîüÊàêÂºèAIËÉΩÂäõË™çË≠â</p>
                            <small>ËºîÂä©Á∑¥Áøí - Ë£úÂº∑Âü∫Á§éÁü•Ë≠ò</small>
                        </div>
                        <div class="exam-specs iii mt-3">
                            <strong>üìã ÂÆòÊñπËÄÉË©¶Ë¶èÁØÑÔºö</strong><br>
                            ‚Ä¢ Á∏ΩÈ°åÊï∏Ôºö80È°åÈÅ∏ÊìáÈ°å<br>
                            ‚Ä¢ ËÄÉË©¶ÊôÇÈñìÔºö90ÂàÜÈêò<br>
                            ‚Ä¢ ÂèäÊ†ºÊ®ôÊ∫ñÔºö70ÂàÜÂèäÊ†ºÔºàÂèØÈåØ24È°åÔºâ<br>
                            ‚Ä¢ ËÄÉË©¶ÊñπÂºèÔºöÈõªËÖ¶Ê∏¨È©óÔºåÈ°åÂ∫´Èö®Ê©üÊäΩÂèñ
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ë®≠ÂÆöÈù¢Êùø -->
        <div id="settings-panel" class="settings-panel">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-gradient text-white text-center py-3" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Ê∏¨È©óË®≠ÂÆö</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label fw-bold">
                                <i class="fas fa-list-ol me-2 text-primary"></i>È°åÁõÆÊï∏Èáè
                            </label>
                            <select id="question-count" class="form-select">
                                <option value="10">10È°å - Âø´ÈÄüÁ∑¥Áøí</option>
                                <option value="20">20È°å - Ê®ôÊ∫ñÁ∑¥Áøí</option>
                                <option value="40">40È°å - Âä†Âº∑Á∑¥Áøí</option>
                                <option value="50">50È°å - ÂñÆÁßëÊ®ôÊ∫ñ</option>
                                <option value="80">80È°å - Ë≥áÁ≠ñÊúÉÊ®ôÊ∫ñ</option>
                                <option value="100" selected>100È°å - iPASÊ®ôÊ∫ñ</option>
                            </select>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label fw-bold">
                                <i class="fas fa-play-circle me-2 text-success"></i>Á∑¥ÁøíÊ®°Âºè
                            </label>
                            <div class="d-flex flex-wrap gap-1">
                                <button class="mode-btn active" data-mode="practice">
                                    <i class="fas fa-book me-1"></i>Á∑¥ÁøíÊ®°Âºè
                                </button>
                                <button class="mode-btn" data-mode="exam">
                                    <i class="fas fa-clock me-1"></i>Ê®°Êì¨ËÄÉË©¶
                                </button>
                            </div>
                            <!-- Ë§áÁøíÊ®°ÂºèÈÅ∏ÊìáÂçÄ -->
                            <div class="review-modes mt-2" id="review-modes-section" style="display: none;">
                                <h6 class="mb-2"><i class="fas fa-redo me-2"></i>Ë§áÁøíÊ®°ÂºèÈÅ∏Êìá</h6>
                                <div class="review-mode-item" data-review-mode="wrong" id="review-wrong-mode">
                                    <i class="fas fa-times-circle me-2"></i>ÈåØÈ°åË§áÁøí
                                    <small class="d-block text-muted">Ë§áÁøí‰πãÂâçÁ≠îÈåØÁöÑÈ°åÁõÆ</small>
                                </div>
                                <div class="review-mode-item" data-review-mode="all" id="review-all-mode">
                                    <i class="fas fa-list me-2"></i>ÂÖ®È°åË§áÁøí
                                    <small class="d-block text-muted">Á≥ªÁµ±ÊÄßË§áÁøíÊâÄÊúâÈ°åÁõÆ</small>
                                </div>
                                <div class="review-mode-item" data-review-mode="topic" id="review-topic-mode">
                                    <i class="fas fa-tags me-2"></i>‰∏ªÈ°åË§áÁøí
                                    <small class="d-block text-muted">Êåâ‰∏ªÈ°åÂàÜÈ°ûË§áÁøí</small>
                                </div>
                                <div class="review-mode-item" data-review-mode="random" id="review-random-mode">
                                    <i class="fas fa-random me-2"></i>Èö®Ê©üË§áÁøí
                                    <small class="d-block text-muted">Èö®Ê©üÈ†ÜÂ∫èË§áÁøí</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label fw-bold">
                                <i class="fas fa-lightbulb me-2 text-warning"></i>Ëß£ÊûêÊ®°Âºè
                            </label>
                            <div class="mb-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="explanation-mode" id="database-mode" value="database" checked>
                                    <label class="form-check-label" for="database-mode">Ë≥áÊñôÂ∫´Ëß£Êûê</label>
                                </div>
                                <div class="form-check form-check-inline" style="display: none;">
                                    <input class="form-check-input" type="radio" name="explanation-mode" id="ai-mode" value="ai">
                                    <label class="form-check-label" for="ai-mode">AIÁîüÊàêËß£Êûê</label>
                                </div>
                            </div>
                            <div id="ai-model-select" class="d-none">
                                <select id="ai-model" class="form-select form-select-sm">
                                    <option value="gpt-4o" selected>GPT-4o (Êé®Ëñ¶)</option>
                                    <option value="claude-3.7-sonnet">Claude 3.7 Sonnet</option>
                                    <option value="grok-3">Grok 3</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6">
                            <label class="form-label fw-bold">
                                <i class="fas fa-rocket me-2 text-danger"></i>Ê∫ñÂÇôÂ∞±Á∑í
                            </label>
                            <button id="start-btn" class="btn btn-danger w-100 mb-2" disabled>
                                <i class="fas fa-play me-2"></i>ÈñãÂßãÁ∑¥Áøí
                            </button>
                            <button id="review-btn-main" class="btn btn-success w-100 mb-2" disabled style="display: none;">
                                <i class="fas fa-redo me-2"></i>ÈñãÂßãË§áÁøí
                            </button>
                            <div id="timer" class="timer text-center">
                                <i class="fas fa-clock me-2"></i>Ë´ãÂÖàÈÅ∏ÊìáÈ°åÂ∫´
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÂïèÈ°åÂçÄÂüü -->
        <div id="quiz-container" class="quiz-container d-none">
            <!-- ËÄÉË©¶Ë®àÊôÇÂô® - Âú®Ê∏¨È©óÈÄ≤Ë°åÊôÇÈ°ØÁ§∫ -->
            <div id="quiz-timer-display" class="quiz-timer-display" style="display: none;">
                <i class="fas fa-clock me-2"></i>Ââ©È§òÊôÇÈñì: --:--
            </div>
            
            <!-- ËøîÂõûÈÅ∏ÊìáÊåâÈàï -->
            <button id="back-to-selection" class="back-to-selection">
                <i class="fas fa-arrow-left me-2"></i>ËøîÂõûÈ°åÂ∫´ÈÅ∏Êìá
            </button>
            
            <div class="progress mb-3">
                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 id="question-number" class="mb-0">ÂïèÈ°å 1/100</h5>
                <div class="d-flex gap-2 align-items-center">
                    <!-- Êñ∞Â¢ûÔºöÊ®ôË®òËàá‰øÆÊîπÊåâÈàï -->
                    <button id="mark-review-btn" class="btn btn-sm mark-review-btn">
                        <i class="fas fa-flag"></i> Ê®ôË®òÊ≠§È°å
                    </button>
                    <button id="modify-answer-btn" class="btn btn-sm modify-answer-btn d-none">
                        <i class="fas fa-edit"></i> ‰øÆÊîπÁ≠îÊ°à
                    </button>
                    <span id="database-badge" class="badge-custom">iPASÈ°åÂ∫´</span>
                    <span id="stats-display" class="badge bg-info">ÂæóÂàÜ: 0/0 (0%)</span>
                </div>
            </div>
            
            <h4 id="question-text" class="mb-4">ËºâÂÖ•È°åÁõÆ‰∏≠...</h4>
            
            <div id="options-container" class="mb-4">
                <!-- ÈÅ∏È†ÖÊúÉÂú®JavaScript‰∏≠ÂãïÊÖãÁîüÊàê -->
            </div>
            
            <div id="explanation-box" class="explanation-box d-none">
                <h5 class="mb-3"><i class="fas fa-lightbulb me-2"></i>Á≠îÊ°àËß£Êûê</h5>
                <div id="explanation-content"></div>
                <div class="mt-3">
                    <span id="topic-badge" class="badge bg-secondary me-2"></span>
                    <span id="subtopic-badge" class="badge bg-info"></span>
                </div>
            </div>
        </div>
        
        <!-- Â∫ïÈÉ®Â∞éËà™ -->
        <div class="bottom-nav" id="bottom-navigation">
            <div class="container-fluid">
                <div class="row justify-content-between align-items-center">
                    <div class="col-2">
                        <button id="prev-btn" class="btn btn-secondary w-100" disabled>
                            <i class="fas fa-arrow-left me-1"></i> 
                            <span class="d-none d-sm-inline">‰∏ä‰∏ÄÈ°å</span>
                        </button>
                    </div>
                    <div class="col-2">
                        <button id="submit-btn" class="btn btn-primary w-100" disabled>
                            <i class="fas fa-check me-1"></i> 
                            <span class="d-none d-sm-inline">Êèê‰∫§</span>
                        </button>
                    </div>
                    <div class="col-2">
                        <button id="next-btn" class="btn btn-warning w-100" disabled>
                            <span class="d-none d-sm-inline">‰∏ã‰∏ÄÈ°å</span>
                            <i class="fas fa-arrow-right ms-1"></i>
                        </button>
                    </div>
                    <div class="col-2">
                        <button id="finish-btn" class="btn btn-success w-100" disabled>
                            <i class="fas fa-flag-checkered me-1"></i> 
                            <span class="d-none d-sm-inline">ÂÆåÊàê</span>
                        </button>
                    </div>
                     <div class="col-2">
                        <button id="overview-btn" class="btn btn-info w-100">
                            <i class="fas fa-th me-1"></i> 
                            <span class="d-none d-sm-inline">È°åËôüÁ∏ΩË¶Ω</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê®°ÊÖãÊ°Ü -->
    <!-- Ê∏¨È©óÁµêÊûúÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="result-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Ê∏¨È©óÁµêÊûú</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="result-content" style="max-height: 70vh; overflow-y: auto;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                    <button type="button" class="btn btn-success" id="restart-quiz-btn">
                        <i class="fas fa-redo me-1"></i>ÈáçÊñ∞Ê∏¨È©ó
                    </button>
                    <button type="button" class="btn btn-primary" id="review-wrong-btn">
                        <i class="fas fa-times-circle me-1"></i>Ë§áÁøíÈåØÈ°å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏ªÈ°åÈÅ∏ÊìáÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="topic-selection-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="fas fa-tags me-2"></i>ÈÅ∏ÊìáË§áÁøí‰∏ªÈ°å</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Ë´ãÈÅ∏ÊìáÊÇ®ÊÉ≥Ë¶ÅË§áÁøíÁöÑ‰∏ªÈ°åÔºàÂèØË§áÈÅ∏ÔºâÔºö</p>
                    <div class="mb-3">
                        <button id="select-all-topics-btn" class="btn btn-sm btn-outline-primary">ÂÖ®ÈÅ∏</button>
                        <button id="deselect-all-topics-btn" class="btn btn-sm btn-outline-secondary">ÂèñÊ∂àÂÖ®ÈÅ∏</button>
                    </div>
                    <div id="topic-list-container" style="max-height: 50vh; overflow-y: auto;">
                        <!-- ‰∏ªÈ°åÂàóË°®Â∞áÁî± JavaScript ÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" id="confirm-topic-selection-btn">
                        <i class="fas fa-check me-1"></i>Á¢∫Ë™çÈÅ∏Êìá
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Áµ±Ë®àË≥áÊñôÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="stats-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">Â≠∏ÁøíÁµ±Ë®à</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="stats-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                    <button type="button" class="btn btn-danger" id="reset-stats-btn">ÈáçÁΩÆÂ≠∏ÁøíÈÄ≤Â∫¶</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰ΩøÁî®Ë™™ÊòéÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="help-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">iPASËÄÉË©¶Ê∫ñÂÇôÊåáÂçó</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h5><i class="fas fa-target me-2 text-primary"></i>ËÄÉË©¶Ê∫ñÂÇôÁ≠ñÁï•</h5>
                    <div class="alert alert-info">
                        <strong>ËÄÉË©¶Ë≥áË®äÔºö</strong>iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´ÂàùÁ¥öË™çË≠âÔºåÂª∫Ë≠∞Ê∫ñÂÇôÊôÇÈñìÔºö4-6ÈÄ±
                    </div>
                    
                    <h6>üìö Ë§áÁøíÊ®°Âºè‰ΩøÁî®Âª∫Ë≠∞</h6>
                    <ul>
                        <li><strong>ÈåØÈ°åË§áÁøíÔºö</strong>ÈáçÈªûÊîªÂÖãËñÑÂº±Áí∞ÁØÄ</li>
                        <li><strong>ÂÖ®È°åË§áÁøíÔºö</strong>Á≥ªÁµ±ÊÄßÂõûÈ°ßÊâÄÊúâÂÖßÂÆπ</li>
                        <li><strong>‰∏ªÈ°åË§áÁøíÔºöÔºö</strong>ÈáùÂ∞çÁâπÂÆöÈ†òÂüüÂä†Âº∑</li>
                        <li><strong>Èö®Ê©üË§áÁøíÔºöÔºö</strong>Ê®°Êì¨ËÄÉË©¶Èö®Ê©üÂá∫È°å</li>
                    </ul>
                    
                    <h6>üìã Á∑¥ÁøíÊ®°ÂºèÂª∫Ë≠∞</h6>
                    <ul>
                        <li><strong>ÊØèÊó•Á∑¥ÁøíÔºö</strong>20-50È°åÁ∂≠ÊåÅÊâãÊÑü</li>
                        <li><strong>ÈÄ±Êú´Ê®°Êì¨ÔºöÔºö</strong>100È°åÂÆåÊï¥Ê∏¨È©ó</li>
                        <li><strong>ËÄÉÂâçË°ùÂà∫ÔºöÔºö</strong>ÈåØÈ°åË§áÁøíÊ®°Âºè</li>
                    </ul>
                    
                    <h6>üéØ ÈáçÈªûÈ°åÂûã</h6>
                    <ul>
                        <li>AIÊäÄË°ìÊáâÁî®ËàáÂïÜÊ•≠ÂÉπÂÄºË©ï‰º∞</li>
                        <li>Â∞àÊ°àË¶èÂäÉËàáÁÆ°ÁêÜÊµÅÁ®ã</li>
                        <li>Êï∏ÊìöÂàÜÊûêËàáÊ®°ÂûãË©ï‰º∞</li>
                        <li>ÂÄ´ÁêÜËàáÈ¢®Èö™ÁÆ°ÁêÜ</li>
                    </ul>
                    
                    <h6>‚è±Ô∏è Ê®°Êì¨ËÄÉË©¶Âª∫Ë≠∞</h6>
                    <ul>
                        <li><strong>iPASÊ®°ÂºèÔºöÔºö</strong>ÈÅ∏Êìá100È°åÊ®ôÊ∫ñÊ®°ÂºèÔºåÊØèÁßë75ÂàÜÈêò</li>
                        <li><strong>Ë≥áÁ≠ñÊúÉÊ®°ÂºèÔºöÔºö</strong>ÈÅ∏Êìá80È°åÔºå90ÂàÜÈêò</li>
                        <li>Âö¥Ê†ºÊéßÂà∂Á≠îÈ°åÊôÇÈñì</li>
                        <li>ÁõÆÊ®ôÊ≠£Á¢∫ÁéáÔºö70%‰ª•‰∏ä</li>
                    </ul>
                    
                    <h6>üìä ‰ΩøÁî®Áµ±Ë®àÂäüËÉΩ</h6>
                    <ul>
                        <li>ÂÆöÊúüÊ™¢Êü•Â≠∏ÁøíÁµ±Ë®à</li>
                        <li>ÈáçÈªûÈóúÊ≥®ËñÑÂº±‰∏ªÈ°å</li>
                        <li>ÂåØÂá∫ÈåØÈ°åÈÄ≤Ë°åÁ¥ôÊú¨Ë§áÁøí</li>
                    </ul>
                    
                    <ul>
                        <li>ÈñãÁôºËÄÖÔºöZN Studio</li>
                        <li>ÁâàÊú¨Ôºö2.2.0 (ÂÆòÊñπË¶èÁØÑÁâà)</li>
                        <li>Êú¨Á≥ªÁµ±Áî±Êú¨‰∫∫Áç®Á´ãË®≠Ë®àËàáÈñãÁôºÔºåÂ∞àÁÇ∫iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´ËÄÉË©¶Ë®≠Ë®à</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Êñ∞Â¢ûÔºöÈ°åËôüÁ∏ΩË¶ΩÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="overview-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title"><i class="fas fa-th me-2"></i>È°åËôüÁ∏ΩË¶Ω</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-center flex-wrap gap-3 mb-3">
                        <span class="badge bg-light text-dark border"><i class="fas fa-circle text-secondary me-1"></i> Êú™‰ΩúÁ≠î</span>
                        <span class="badge bg-success text-white"><i class="fas fa-check-circle me-1"></i> Â∑≤‰ΩúÁ≠î</span>
                        <span class="badge bg-warning text-dark"><i class="fas fa-flag me-1"></i> Â∑≤Ê®ôË®ò</span>
                        <span class="badge bg-primary text-white">Áï∂ÂâçÈ°åÁõÆ</span>
                    </div>
                    <hr>
                    <div id="overview-grid" class="p-3">
                        <!-- È°åËôüÊåâÈàïÂ∞áÁî± JS ÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- iPASÂ≠êÈ†ÖÁõÆÈÅ∏ÊìáÊ®°ÊÖãÊ°Ü -->
    <div class="modal fade" id="ipas-subject-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title"><i class="fas fa-star me-2"></i>ÈÅ∏ÊìáiPASËÄÉË©¶ÁßëÁõÆ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-center mb-4">Ë´ãÈÅ∏ÊìáÊÇ®Ë¶ÅÁ∑¥ÁøíÁöÑiPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´ÁßëÁõÆÔºö</p>
                    <div class="d-grid gap-3">
                        <button type="button" class="btn btn-outline-primary btn-lg ipas-subject-btn" data-subject="ai-basis">
                            <i class="fas fa-brain me-2"></i>‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñ
                            <small class="d-block text-muted mt-1">AIÂü∫Á§éÁêÜË´ñËàáÊ¶ÇÂøµ</small>
                        </button>
                        <button type="button" class="btn btn-outline-success btn-lg ipas-subject-btn" data-subject="ai-application">
                            <i class="fas fa-cogs me-2"></i>ÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉ
                            <small class="d-block text-muted mt-1">ÂØ¶ÂãôÊáâÁî®ËàáË¶èÂäÉÁ≠ñÁï•</small>
                        </button>
                        <button type="button" class="btn btn-outline-info btn-lg ipas-subject-btn" data-subject="ipas-combined">
                            <i class="fas fa-layer-group me-2"></i>Á∂úÂêàËÄÉÈ°å
                            <small class="d-block text-muted mt-1">ÂÖ©ÁßëÁõÆÊ∑∑ÂêàÁ∑¥Áøí</small>
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Âä†ËºâÈÅÆÁΩ© -->
    <div id="loading-overlay" class="overlay d-none">
        <div class="loader"></div>
        <div id="loading-text" class="loading-text">ËôïÁêÜ‰∏≠...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // ÂÖ®ÂüüÁãÄÊÖãÁÆ°ÁêÜ
        const iPASQuizApp = {
            // ÊáâÁî®ÁãÄÊÖã
            state: {
                isQuizActive: false,
                selectedDatabase: null,
                currentMode: 'practice',
                selectedReviewMode: null,
                selectedTopicsForReview: [],
                explanationMode: 'database',
                selectedAIModel: 'gpt-4o',
                questions: [],
                currentQuestionIndex: 0,
                userAnswers: {},
                markedQuestions: [], // Êñ∞Â¢ûÔºöÁî®ÊñºÂ≠òÂÑ≤Ê®ôË®òÁöÑÈ°åÁõÆÁ¥¢Âºï
                questionMapping: {}, // Áî®ÊñºÂ≠òÂÑ≤È°åÁõÆÁöÑÈÅ∏È†ÖÈö®Ê©üÂåñÊò†Â∞Ñ
                score: 0,
                wrongQuestions: [],
                startTime: null,
                isTimerRunning: false,
                examDuration: 150, // iPAS: 150ÂàÜÈêò (ÂÖ©ÁßëÂêÑ75ÂàÜÈêò)
                timerId: null,
                userData: null
            },
            
            // DOM ÂÖÉÁ¥†
            elements: {
                databaseSelector: document.getElementById('database-selector'),
                databaseCards: document.querySelectorAll('.database-card'),
                settingsPanel: document.getElementById('settings-panel'),
                quizContainer: document.getElementById('quiz-container'),
                startBtn: document.getElementById('start-btn'),
                reviewBtnMain: document.getElementById('review-btn-main'),
                reviewModesSection: document.getElementById('review-modes-section'),
                backBtn: document.getElementById('back-to-selection'),
                prevBtn: document.getElementById('prev-btn'),
                submitBtn: document.getElementById('submit-btn'),
                nextBtn: document.getElementById('next-btn'),
                finishBtn: document.getElementById('finish-btn'),
                overviewBtn: document.getElementById('overview-btn'), // Êñ∞Â¢û
                markReviewBtn: document.getElementById('mark-review-btn'), // Êñ∞Â¢û
                modifyAnswerBtn: document.getElementById('modify-answer-btn'), // Êñ∞Â¢û
                quizStatus: document.getElementById('quiz-status'),
                timerElement: document.getElementById('timer'),
                quizTimerDisplay: document.getElementById('quiz-timer-display'),
                questionNumber: document.getElementById('question-number'),
                questionText: document.getElementById('question-text'),
                optionsContainer: document.getElementById('options-container'),
                explanationBox: document.getElementById('explanation-box'),
                explanationContent: document.getElementById('explanation-content'),
                progressBar: document.getElementById('progress-bar'),
                statsDisplay: document.getElementById('stats-display'),
                topicBadge: document.getElementById('topic-badge'),
                subtopicBadge: document.getElementById('subtopic-badge'),
                loadingOverlay: document.getElementById('loading-overlay'),
                loadingText: document.getElementById('loading-text')
            },
            
            // Ê®°ÊÖãÊ°Ü
            modals: {
                result: new bootstrap.Modal(document.getElementById('result-modal')),
                stats: new bootstrap.Modal(document.getElementById('stats-modal')),
                help: new bootstrap.Modal(document.getElementById('help-modal')),
                topicSelection: new bootstrap.Modal(document.getElementById('topic-selection-modal')),
                overview: new bootstrap.Modal(document.getElementById('overview-modal')),
                ipasSubject: new bootstrap.Modal(document.getElementById('ipas-subject-modal')) // iPASÂ≠êÈ†ÖÁõÆÈÅ∏Êìá
            },
            
            // ËÄÉË©¶Ë¶èÁØÑÈÖçÁΩÆ
            examConfigs: {
                'ipas': {
                    name: 'iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´',
                    defaultQuestions: 100,
                    duration: 150, // ÂÖ©ÁßëÂêÑ75ÂàÜÈêò
                    passingScore: 70,
                    description: '100È°å | 150ÂàÜÈêò | 70ÂàÜÂèäÊ†º | ÂñÆÁßë‰∏ç‰ΩéÊñº60ÂàÜ'
                },
                'ai-basis': {
                    name: '‰∫∫Â∑•Êô∫ÊÖßÂü∫Á§éÊ¶ÇË´ñ',
                    defaultQuestions: 10,
                    duration: 75,
                    passingScore: 60,
                    description: '10È°å | 75ÂàÜÈêò | 60ÂàÜÂèäÊ†º'
                },
                'ai-application': {
                    name: 'ÁîüÊàêÂºèAIÊáâÁî®ËàáË¶èÂäÉ',
                    defaultQuestions: 10,
                    duration: 75,
                    passingScore: 60,
                    description: '10È°å | 75ÂàÜÈêò | 60ÂàÜÂèäÊ†º'
                },
                'ipas-combined': {
                    name: 'iPASÁ∂úÂêàËÄÉÈ°å',
                    defaultQuestions: 20,
                    duration: 150,
                    passingScore: 70,
                    description: '20È°å | 150ÂàÜÈêò | 70ÂàÜÂèäÊ†º'
                },
                'generative-ai': {
                    name: 'Ë≥áÁ≠ñÊúÉÁîüÊàêÂºèAIË™çË≠â',
                    defaultQuestions: 80,
                    duration: 90,
                    passingScore: 70,
                    description: '80È°å | 90ÂàÜÈêò | 70ÂàÜÂèäÊ†º'
                }
            },
            
            // ÂàùÂßãÂåñ
            init() {
                this.state.userData = this.loadUserData();
                this.attachEventListeners();
                this.updateReviewButtonState();
                console.log('üöÄ iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´Á∑¥ÁøíÁ≥ªÁµ±Â∑≤ÂàùÂßãÂåñ (v2.3.1 ÁôªÂÖ•Êï¥ÂêàÁâà)');
            },
            
            // ËºâÂÖ•‰ΩøÁî®ËÄÖÊï∏Êìö
            loadUserData() {
                try {
                    const data = localStorage.getItem('iPASQuizUserData');
                    return data ? JSON.parse(data) : {
                        correct: [],
                        incorrect: [],
                        history: [],
                        databaseStats: {}
                    };
                } catch (error) {
                    console.error('ËºâÂÖ•‰ΩøÁî®ËÄÖÊï∏ÊìöÈåØË™§:', error);
                    return {
                        correct: [],
                        incorrect: [],
                        history: [],
                        databaseStats: {}
                    };
                }
            },
            
            // ‰øùÂ≠ò‰ΩøÁî®ËÄÖÊï∏Êìö
            saveUserData(showMessage = false) {
                try {
                    localStorage.setItem('iPASQuizUserData', JSON.stringify(this.state.userData));
                    if (showMessage) {
                        this.showAlert('Â≠∏ÁøíÊï∏ÊìöÂ∑≤ÂÑ≤Â≠ò', 'success');
                    }
                    return true;
                } catch (error) {
                    console.error('‰øùÂ≠ò‰ΩøÁî®ËÄÖÊï∏ÊìöÈåØË™§:', error);
                    if (showMessage) {
                        this.showAlert('ÂÑ≤Â≠òÂ§±Êïó: ' + error.message, 'error');
                    }
                    return false;
                }
            },
            
            // ‰∫ã‰ª∂Áõ£ËÅΩÂô®
            attachEventListeners() {
                // È°åÂ∫´ÈÅ∏Êìá
                this.elements.databaseCards.forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (this.state.isQuizActive) {
                            this.showAlert('Ê∏¨È©óÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïÂàáÊèõÈ°åÂ∫´ÔºÅ', 'warning');
                            return;
                        }
                        
                        const cardType = card.dataset.type;
                        if (cardType === 'ipas') {
                            // È°ØÁ§∫iPASÂ≠êÈ†ÖÁõÆÈÅ∏ÊìáÊ®°ÊÖãÊ°Ü
                            this.modals.ipasSubject.show();
                        } else {
                            this.selectDatabase(cardType);
                        }
                    });
                });

                document.getElementById('confirm-topic-selection-btn').addEventListener('click', () => this.confirmTopicSelection());
                document.getElementById('select-all-topics-btn').addEventListener('click', () => this.toggleAllTopics(true));
                document.getElementById('deselect-all-topics-btn').addEventListener('click', () => this.toggleAllTopics(false));

                // iPASÂ≠êÈ†ÖÁõÆÈÅ∏ÊìáÊåâÈàï‰∫ã‰ª∂
                document.querySelectorAll('.ipas-subject-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const subject = e.currentTarget.dataset.subject;
                        this.selectDatabase(subject);
                        this.modals.ipasSubject.hide();
                    });
                });

                // ÊåâÈàï‰∫ã‰ª∂
                this.elements.startBtn.addEventListener('click', () => this.startQuiz());
                this.elements.reviewBtnMain.addEventListener('click', () => this.startReview());
                this.elements.backBtn.addEventListener('click', () => this.backToSelection());
                this.elements.prevBtn.addEventListener('click', () => this.prevQuestion());
                this.elements.submitBtn.addEventListener('click', () => this.submitAnswer());
                this.elements.nextBtn.addEventListener('click', () => this.nextQuestion());
                this.elements.finishBtn.addEventListener('click', () => this.finishQuiz());
                this.elements.overviewBtn.addEventListener('click', () => this.showOverviewModal()); // Êñ∞Â¢û
                this.elements.markReviewBtn.addEventListener('click', () => this.toggleMarkForReview()); // Êñ∞Â¢û
                this.elements.modifyAnswerBtn.addEventListener('click', () => this.enableAnswerModification()); // Êñ∞Â¢û
                
                // Ë§áÁøíÊ®°ÂºèÈÅ∏Êìá‰∫ã‰ª∂
                document.querySelectorAll('.review-mode-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (this.state.isQuizActive) {
                            this.showAlert('Ê∏¨È©óÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïÊõ¥ÊîπË§áÁøíÊ®°ÂºèÔºÅ', 'warning');
                            return;
                        }
                        const mode = item.dataset.reviewMode;
                        this.selectReviewMode(mode);

                        // Â¶ÇÊûúÊòØ‰∏ªÈ°åË§áÁøíÔºåÂâáÊâìÈñãÈÅ∏ÊìáË¶ñÁ™ó
                        if (mode === 'topic') {
                            this.openTopicSelectionModal();
                        }
                    });
                });
                
                // Â∞éËà™ÊåâÈàï
                document.getElementById('save-btn').addEventListener('click', () => this.saveUserData(true));
                document.getElementById('export-btn').addEventListener('click', () => this.exportWrongQuestions());
                document.getElementById('stats-btn').addEventListener('click', () => this.showStatistics());
                document.getElementById('help-btn').addEventListener('click', () => this.modals.help.show());
                
                // Ê®°ÂºèÈÅ∏Êìá
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (this.state.isQuizActive) {
                            this.showAlert('Ê∏¨È©óÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïÊõ¥ÊîπÊ®°ÂºèÔºÅ', 'warning');
                            return;
                        }
                        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.state.currentMode = btn.dataset.mode;
                        this.updateModeUI();
                    });
                });
                
                // Ëß£ÊûêÊ®°ÂºèÈÅ∏Êìá
                document.querySelectorAll('[name="explanation-mode"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.state.explanationMode = e.target.value;
                        const aiModelSelect = document.getElementById('ai-model-select');
                        if (this.state.explanationMode === 'ai') {
                            aiModelSelect.classList.remove('d-none');
                        } else {
                            aiModelSelect.classList.add('d-none');
                        }
                    });
                });
                
                // AIÊ®°ÂûãÈÅ∏Êìá
                document.getElementById('ai-model').addEventListener('change', (e) => {
                    this.state.selectedAIModel = e.target.value;
                });
                
                // Ê®°ÊÖãÊ°ÜÊåâÈàï
                document.getElementById('review-wrong-btn').addEventListener('click', () => this.reviewWrongQuestions());
                document.getElementById('restart-quiz-btn').addEventListener('click', () => this.restartQuiz());
                document.getElementById('reset-stats-btn').addEventListener('click', () => this.resetProgress());
                
                // È†ÅÈù¢ÈóúÈñâÂâçËá™Âãï‰øùÂ≠ò
                window.addEventListener('beforeunload', () => this.saveUserData(false));
            },
            
            // ÈÅ∏ÊìáË§áÁøíÊ®°Âºè
            selectReviewMode(mode) {
                document.querySelectorAll('.review-mode-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                const selectedItem = document.querySelector(`[data-review-mode="${mode}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('selected');
                    this.state.selectedReviewMode = mode;
                    this.updateReviewButtonState();
                    console.log(`‚úÖ Â∑≤ÈÅ∏ÊìáË§áÁøíÊ®°Âºè: ${mode}`);
                }
            },
            
            // Êõ¥Êñ∞Ê®°ÂºèUI
            updateModeUI() {
                if (this.state.currentMode === 'practice' || this.state.currentMode === 'exam') {
                    this.elements.reviewModesSection.style.display = 'none';
                    this.elements.startBtn.style.display = 'block';
                    this.elements.reviewBtnMain.style.display = 'none';
                }
                
                // Ê†πÊìöÊ®°ÂºèÊõ¥Êñ∞Ë®àÊôÇÂô®È°ØÁ§∫
                this.updateTimerForMode();
            },
            
            // Ê†πÊìöÊ®°ÂºèÊõ¥Êñ∞Ë®àÊôÇÂô®È°ØÁ§∫
            updateTimerForMode() {
                if (!this.state.selectedDatabase) return;
                
                const config = this.examConfigs[this.state.selectedDatabase];
                if (!config) return;
                
                if (this.state.currentMode === 'exam') {
                    this.elements.timerElement.innerHTML = 
                        `<i class="fas fa-clock me-2"></i>${config.name} | ËÄÉË©¶ÊôÇÈñìÔºö${config.duration}ÂàÜÈêò`;
                    this.elements.timerElement.classList.add('exam-mode');
                } else {
                    this.elements.timerElement.innerHTML = 
                        `<i class="fas fa-clock me-2"></i>Â∑≤ÈÅ∏ÊìáÔºö${config.name}`;
                    this.elements.timerElement.classList.remove('exam-mode');
                }
            },
            
            // ÈñãÂßãË§áÁøí
            startReview() {
                if (!this.state.selectedDatabase) {
                    this.showAlert('Ë´ãÂÖàÈÅ∏ÊìáÈ°åÂ∫´ÔºÅ', 'warning');
                    return;
                }
                
                if (!this.state.selectedReviewMode) {
                    this.showAlert('Ë´ãÈÅ∏ÊìáË§áÁøíÊ®°ÂºèÔºÅ', 'warning');
                    return;
                }
                
                if (this.state.selectedReviewMode === 'topic' && (!this.state.selectedTopicsForReview || this.state.selectedTopicsForReview.length === 0)) {
                    this.showAlert('Ë´ãÂÖàÈªûÊìä„Äå‰∏ªÈ°åË§áÁøí„ÄçÊåâÈàï‰æÜÈÅ∏ÊìáË¶ÅË§áÁøíÁöÑ‰∏ªÈ°åÔºÅ', 'warning');
                    this.openTopicSelectionModal();
                    return;
                }

                this.showLoading('Ê∫ñÂÇôË§áÁøíÊ®°Âºè...');
                
                this.state.isQuizActive = true;
                this.state.currentMode = 'review';
                this.lockInterface();
                
                setTimeout(() => {
                    if (this.loadReviewQuestions()) {
                        this.state.currentQuestionIndex = 0;
                        this.state.userAnswers = {};
                        this.state.markedQuestions = []; // Êñ∞Â¢ûÈÄô‰∏ÄË°å
                        this.state.questionMapping = {};
                        this.state.score = 0;
                        this.state.wrongQuestions = [];
                        this.state.startTime = new Date();
                        
                        this.elements.settingsPanel.classList.add('d-none');
                        this.elements.quizContainer.classList.remove('d-none');
                        this.elements.quizStatus.style.display = 'block';
                        this.elements.quizStatus.classList.add('active');
                        this.elements.quizStatus.innerHTML = '<i class="fas fa-redo me-1"></i>Ë§áÁøíÈÄ≤Ë°å‰∏≠';
                        
                        this.displayQuestion();
                        this.hideLoading();
                        console.log('‚úÖ Ë§áÁøíÂ∑≤ÈñãÂßã');
                    } else {
                        this.hideLoading();
                        this.state.isQuizActive = false;
                        this.unlockInterface();
                    }
                }, 500);
            },
            
            // ËºâÂÖ•Ë§áÁøíÈ°åÁõÆ
            loadReviewQuestions() {
                const currentQuizData = quizData[this.state.selectedDatabase];
                
                if (!currentQuizData || currentQuizData.length === 0) {
                    this.showAlert(`${this.examConfigs[this.state.selectedDatabase]?.name || this.state.selectedDatabase}È°åÂ∫´Â∞öÊú™ËºâÂÖ•ÊàñÁÇ∫Á©∫ÔºÅ`, 'error');
                    return false;
                }
                
                let questionsToReview = [];
                const questionCount = parseInt(document.getElementById('question-count').value);
                
                switch (this.state.selectedReviewMode) {
                    case 'wrong':
                        const incorrectQuestions = this.state.userData.incorrect || [];
                        questionsToReview = currentQuizData.filter(q => 
                            incorrectQuestions.includes(q.question)
                        );
                        if (questionsToReview.length === 0) {
                            this.showAlert('ÁõÆÂâçÊ≤íÊúâÈåØÈ°åË®òÈåÑÔºåË´ãÂÖàÈÄ≤Ë°åÁ∑¥ÁøíÔºÅ', 'info');
                            return false;
                        }
                        break;
                        
                    case 'all':
                        questionsToReview = currentQuizData.slice(0, Math.min(questionCount, currentQuizData.length));
                        break;
                        
                    case 'topic':
                        const selectedTopics = this.state.selectedTopicsForReview;
                        if (!selectedTopics || selectedTopics.length === 0) {
                            this.showAlert('ÈåØË™§ÔºöÊú™ÊâæÂà∞ÈÅ∏ÊìáÁöÑ‰∏ªÈ°å„ÄÇË´ãÈáçÊñ∞ÈÅ∏Êìá„ÄÇ', 'error');
                            return false;
                        }
                        questionsToReview = currentQuizData.filter(q => selectedTopics.includes(q.topic || 'Êú™ÂàÜÈ°û'));
                        
                        if (questionsToReview.length === 0) {
                            this.showAlert(`Âú®ÊÇ®ÈÅ∏ÊìáÁöÑ‰∏ªÈ°å‰∏≠Êâæ‰∏çÂà∞‰ªª‰ΩïÈ°åÁõÆ„ÄÇ`, 'info');
                            return false;
                        }
                        questionsToReview = questionsToReview.sort(() => Math.random() - 0.5)
                            .slice(0, Math.min(questionCount, questionsToReview.length));
                        break;

                    case 'random':
                        questionsToReview = [...currentQuizData].sort(() => Math.random() - 0.5)
                            .slice(0, Math.min(questionCount, currentQuizData.length));
                        break;
                        
                    default:
                        this.showAlert('Êú™Áü•ÁöÑË§áÁøíÊ®°ÂºèÔºÅ', 'error');
                        return false;
                }
                
                this.state.questions = questionsToReview;
                this.state.questions.forEach((q, index) => q.number = index + 1);
                
                return true;
            },

            selectDatabase(type) {
                this.elements.databaseCards.forEach(card => card.classList.remove('selected'));
                
                // ÁÇ∫iPASÁõ∏ÈóúÁöÑÂ≠êÁßëÁõÆÔºåÈÅ∏‰∏≠iPAS‰∏ªÂç°
                if (['ai-basis', 'ai-application', 'ipas-combined'].includes(type)) {
                    const iPASCard = document.querySelector(`[data-type="ipas"]`);
                    if (iPASCard) iPASCard.classList.add('selected');
                } else {
                    const selectedCard = document.querySelector(`[data-type="${type}"]`);
                    if (selectedCard) selectedCard.classList.add('selected');
                }
                
                this.state.selectedDatabase = type;
                this.state.selectedIPASSubject = type;
                this.state.selectedTopicsForReview = [];
                this.updateDatabaseUI(type);
                this.elements.startBtn.disabled = false;
                this.updateReviewButtonState();
                
                console.log(`‚úÖ Â∑≤ÈÅ∏ÊìáÈ°åÂ∫´: ${type}`);
            },
            
            // Êõ¥Êñ∞È°åÂ∫´UI
            updateDatabaseUI(type) {
                const config = this.examConfigs[type];
                if (!config) return;
                
                // Êõ¥Êñ∞ËÄÉË©¶ÊôÇÈñì
                this.state.examDuration = config.duration;
                
                // Êõ¥Êñ∞È†êË®≠È°åÁõÆÊï∏Èáè
                document.getElementById('question-count').value = config.defaultQuestions;
                
                // ‰ΩøÁî®Êñ∞ÁöÑ updateTimerForMode ÊñπÊ≥ï‰æÜÊõ¥Êñ∞Ë®àÊôÇÂô®È°ØÁ§∫
                if (this.state.currentMode === 'exam') {
                    this.elements.timerElement.innerHTML = 
                        `<i class="fas fa-clock me-2"></i>${config.name} | ËÄÉË©¶ÊôÇÈñìÔºö${config.duration}ÂàÜÈêò`;
                    this.elements.timerElement.classList.add('exam-mode');
                } else {
                    this.elements.timerElement.innerHTML = 
                        `<i class="fas fa-clock me-2"></i>Â∑≤ÈÅ∏ÊìáÔºö${config.name}`;
                    this.elements.timerElement.classList.remove('exam-mode');
                }
                
                // Â¶ÇÊûúÊòØiPASÁõ∏ÈóúÔºåË®≠ÂÆöÁÇ∫Á∑¥ÁøíÊ®°Âºè
                if (['ipas', 'ai-basis', 'ai-application', 'ipas-combined'].includes(type)) {
                    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelector('[data-mode="practice"]').classList.add('active');
                    this.state.currentMode = 'practice';
                }
            },
            
            // Êõ¥Êñ∞Ë§áÁøíÊåâÈàïÁãÄÊÖã
            updateReviewButtonState() {
                const hasWrongQuestions = this.state.userData.incorrect && this.state.userData.incorrect.length > 0;
                const hasSelectedDatabase = this.state.selectedDatabase !== null;
                
                if (hasSelectedDatabase) {
                    this.elements.reviewModesSection.style.display = 'block';
                    this.elements.startBtn.style.display = 'block';
                    this.elements.reviewBtnMain.style.display = 'block';
                } else {
                    this.elements.reviewModesSection.style.display = 'none';
                    this.elements.reviewBtnMain.style.display = 'none';
                }
                
                const wrongModeItem = document.getElementById('review-wrong-mode');
                if (wrongModeItem) {
                    if (hasWrongQuestions) {
                        wrongModeItem.style.opacity = '1';
                        wrongModeItem.style.pointerEvents = 'auto';
                        wrongModeItem.title = 'Ë§áÁøí‰πãÂâçÁ≠îÈåØÁöÑÈ°åÁõÆ';
                    } else {
                        wrongModeItem.style.opacity = '0.5';
                        wrongModeItem.style.pointerEvents = 'none';
                        wrongModeItem.title = 'Â∞öÁÑ°ÈåØÈ°åË®òÈåÑ';
                    }
                }
                
                this.elements.reviewBtnMain.disabled = !hasSelectedDatabase;
            },

            openTopicSelectionModal() {
                if (!this.state.selectedDatabase) {
                    this.showAlert('Ë´ãÂÖàÈÅ∏ÊìáÈ°åÂ∫´ÔºÅ', 'warning');
                    return;
                }

                const currentQuizData = quizData[this.state.selectedDatabase];
                if (!currentQuizData || currentQuizData.length === 0) {
                    this.showAlert('Ê≠§È°åÂ∫´ÁÑ°È°åÁõÆÂèØ‰æõÈÅ∏Êìá‰∏ªÈ°åÔºÅ', 'error');
                    return;
                }

                const allTopics = currentQuizData.map(q => q.topic || 'Êú™ÂàÜÈ°û');
                const uniqueTopics = [...new Set(allTopics)].sort();

                const container = document.getElementById('topic-list-container');
                container.innerHTML = '';

                uniqueTopics.forEach((topic, index) => {
                    const isChecked = this.state.selectedTopicsForReview.includes(topic) ? 'checked' : '';
                    const topicHTML = `
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="${topic}" id="topic-check-${index}" ${isChecked}>
                            <label class="form-check-label" for="topic-check-${index}">
                                ${topic}
                            </label>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', topicHTML);
                });

                this.modals.topicSelection.show();
            },

            confirmTopicSelection() {
                const selectedCheckboxes = document.querySelectorAll('#topic-list-container input[type="checkbox"]:checked');
                this.state.selectedTopicsForReview = Array.from(selectedCheckboxes).map(cb => cb.value);

                if (this.state.selectedTopicsForReview.length === 0) {
                    this.showAlert('ÊÇ®Â∞öÊú™ÈÅ∏Êìá‰ªª‰Ωï‰∏ªÈ°åÔºÅ', 'warning');
                    return;
                }

                this.modals.topicSelection.hide();
                this.showAlert(`Â∑≤ÈÅ∏Êìá ${this.state.selectedTopicsForReview.length} ÂÄã‰∏ªÈ°åÔºåË´ãÈªûÊìä„ÄåÈñãÂßãË§áÁøí„Äç`, 'success');
                this.updateReviewButtonState();
            },

            toggleAllTopics(select) {
                const checkboxes = document.querySelectorAll('#topic-list-container input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = select;
                });
            },
            
// ÈñãÂßãÊ∏¨È©ó
async startQuiz() {
    // ========== Êñ∞Â¢ûÔºöÊúÉÂì°ÁãÄÊÖãÊ™¢Êü• ==========
    // ÂÑ™ÂÖàÂæûÊñ∞ÁöÑ user_data ÂèñÂæó userId
    const generalUserData = JSON.parse(localStorage.getItem('user_data') || '{}');
    const lineUserData = JSON.parse(localStorage.getItem('ipas_user_data') || '{}');
    const userId = generalUserData.google_id || generalUserData.userId || lineUserData.userId;
    
    let isPaid = false;
    
    if (userId) {
        const status = await LoginManager.checkMemberStatus(userId);
        isPaid = status.isPaid;
    }
    
    // Ê™¢Êü•‰ΩøÁî®Ê¨°Êï∏ÈôêÂà∂
    if (!UsageManager.canUseSystem(isPaid)) {
        this.showAlert('‰ªäÊó•ÂÖçË≤ªÁ∑¥ÁøíÂ∑≤ÈÅî5Ê¨°ÈôêÂà∂ÔºÅË´ãÂçáÁ¥ö‰ªòË≤ªÊúÉÂì°‰∫´ÂèóÁÑ°ÈôêÂà∂Á∑¥Áøí„ÄÇ', 'warning');
        return;
    }
    
    // Â¢ûÂä†‰ΩøÁî®Ê¨°Êï∏
    UsageManager.incrementUsage();
    
                if (!this.state.selectedDatabase) {
                    this.showAlert('Ë´ãÂÖàÈÅ∏ÊìáÈ°åÂ∫´ÔºÅ', 'warning');
                    return;
                }
                
                const config = this.examConfigs[this.state.selectedDatabase];
                
                // Â¶ÇÊûúÊòØËÄÉË©¶Ê®°ÂºèÔºåÂä†ÂÖ•Á¢∫Ë™çÊ©üÂà∂
                if (this.state.currentMode === 'exam') {
                    const confirmStart = confirm(
                        `Á¢∫ÂÆöË¶ÅÈñãÂßã${config.name}Ê®°Êì¨ËÄÉË©¶ÂóéÔºü\n\n` +
                        '‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºö\n' +
                        `‚Ä¢ ËÄÉË©¶ÊôÇÈñìÔºö${config.duration}ÂàÜÈêò\n` +
                        '‚Ä¢ ‰∏ÄÊó¶ÈñãÂßãÁÑ°Ê≥ïÊö´ÂÅúÊàñÈáçÁΩÆ\n' +
                        '‚Ä¢ ÁÑ°Ê≥ïËøîÂõûÈ°åÂ∫´ÈÅ∏Êìá\n' +
                        '‚Ä¢ ÊôÇÈñìÂà∞Â∞áËá™Âãï‰∫§Âç∑\n\n' +
                        'Ë´ãÁ¢∫Ë™çÊÇ®Â∑≤Ê∫ñÂÇôÂ∞±Á∑íÔºÅ'
                    );
                    
                    if (!confirmStart) {
                        return;
                    }
                }
                
                this.showLoading('Ê∫ñÂÇôÊ∏¨È©ó‰∏≠...');
                
                this.state.isQuizActive = true;
                this.lockInterface();
                
                const questionCount = parseInt(document.getElementById('question-count').value);
                
                setTimeout(() => {
                    if (this.loadQuestions(questionCount)) {
                        this.state.currentQuestionIndex = 0;
                        this.state.userAnswers = {};
                        this.state.markedQuestions = []; // Êñ∞Â¢ûÈÄô‰∏ÄË°å
                        this.state.questionMapping = {};
                        this.state.score = 0;
                        this.state.wrongQuestions = [];
                        this.state.startTime = new Date();
                        
                        this.elements.settingsPanel.classList.add('d-none');
                        this.elements.quizContainer.classList.remove('d-none');
                        this.elements.quizStatus.style.display = 'block';
                        this.elements.quizStatus.classList.add('active');
                        
                        this.displayQuestion();
                        
                        if (this.state.currentMode === 'exam') {
                            this.startTimer();
                        }
                        
                        this.hideLoading();
                        console.log('‚úÖ Ê∏¨È©óÂ∑≤ÈñãÂßã');
                    } else {
                        this.hideLoading();
                        this.state.isQuizActive = false;
                        this.unlockInterface();
                    }
                }, 500);
            },
            
            // ÈéñÂÆö‰ªãÈù¢
            lockInterface() {
                this.elements.databaseSelector.classList.add('disabled');
                this.elements.settingsPanel.classList.add('disabled');
                this.elements.databaseCards.forEach(card => card.classList.add('disabled'));
            },
            
            // Ëß£Èéñ‰ªãÈù¢
            unlockInterface() {
                this.elements.databaseSelector.classList.remove('disabled');
                this.elements.settingsPanel.classList.remove('disabled');
                this.elements.databaseCards.forEach(card => card.classList.remove('disabled'));
            },
            
            // ËºâÂÖ•È°åÁõÆ
            loadQuestions(count) {
                const currentQuizData = quizData[this.state.selectedDatabase];
                const config = this.examConfigs[this.state.selectedDatabase];
                
                if (!currentQuizData || currentQuizData.length === 0) {
                    this.showAlert(`${config?.name || this.state.selectedDatabase}È°åÂ∫´Â∞öÊú™ËºâÂÖ•ÊàñÁÇ∫Á©∫ÔºÅ`, 'error');
                    return false;
                }
                
                const shuffledQuestions = [...currentQuizData].sort(() => Math.random() - 0.5);
                this.state.questions = shuffledQuestions.slice(0, Math.min(count, shuffledQuestions.length));
                this.state.questions.forEach((q, index) => q.number = index + 1);
                
                return true;
            },
            
            // È°ØÁ§∫È°åÁõÆ
displayQuestion() {
                if (!this.state.questions || this.state.currentQuestionIndex >= this.state.questions.length) {
                    this.finishQuiz();
                    return false;
                }
                
                const question = this.state.questions[this.state.currentQuestionIndex];
                const questionId = this.state.currentQuestionIndex;
                const userAnswer = this.state.userAnswers[questionId];
                const isPracticeOrReview = this.state.currentMode === 'practice' || this.state.currentMode === 'review';

                this.elements.questionNumber.textContent = `ÂïèÈ°å ${question.number}/${this.state.questions.length}`;
                this.elements.questionText.textContent = question.question;
                
                // „ÄêÊ†∏ÂøÉ‰øÆÊ≠£Èªû„ÄëÁ¢∫‰øùÂú®Èö®Ê©üÂåñÊôÇÔºåË®àÁÆó‰∏¶ÂÑ≤Â≠òÊ≠£Á¢∫Á≠îÊ°àÁöÑÊñ∞Â≠óÊØç
                if (!this.state.questionMapping[questionId]) {
                    const optionsWithIndex = question.options.map((option, index) => ({
                        text: option,
                        originalIndex: index,
                        isCorrect: index === question.correct_answer_index // Âä†‰∏äÈÄôË°å‰æÜÊ®ôË®òÂì™ÂÄãÊòØÊ≠£Á¢∫ÈÅ∏È†Ö
                    }));
                    
                    const shuffledOptions = [...optionsWithIndex].sort(() => Math.random() - 0.5);

                    // ÊâæÂà∞Ê≠£Á¢∫ÈÅ∏È†ÖÂú®Êñ∞ÁöÑÈö®Ê©üÊï∏ÁµÑ‰∏≠ÁöÑ‰ΩçÁΩÆÔºå‰∏¶ËΩâÊèõÁÇ∫Â≠óÊØç
                    const correctLetter = String.fromCharCode(65 + shuffledOptions.findIndex(opt => opt.isCorrect));

                    this.state.questionMapping[questionId] = {
                        shuffledOptions: shuffledOptions,
                        correctLetter: correctLetter // ÊääË®àÁÆóÂ•ΩÁöÑÊ≠£Á¢∫Â≠óÊØçÂ≠òËµ∑‰æÜ
                    };
                }
                
                const mapping = this.state.questionMapping[questionId];
                this.elements.optionsContainer.innerHTML = mapping.shuffledOptions.map((option, displayIndex) => {
                    const letter = String.fromCharCode(65 + displayIndex);
                    return `<div class="form-check mb-2">
                                <input class="option-input" type="radio" name="quiz-option" id="option-${letter}" value="${letter}" data-original-index="${option.originalIndex}">
                                <label class="option-label" for="option-${letter}">${letter}. ${option.text}</label>
                            </div>`;
                }).join('');
                
                this.elements.explanationBox.classList.add('d-none');
                this.elements.modifyAnswerBtn.classList.add('d-none');
                document.querySelectorAll('input[name="quiz-option"]').forEach(input => input.disabled = false);

                if (userAnswer) {
                    const answerInput = document.getElementById(`option-${userAnswer.answer}`);
                    if (answerInput) answerInput.checked = true;

                    if (isPracticeOrReview) {
                        document.querySelectorAll('input[name="quiz-option"]').forEach(input => input.disabled = true);
                        const isCorrect = userAnswer.originalIndex === question.correct_answer_index;
                        this.showExplanation(question, userAnswer.answer, isCorrect);
                        this.elements.modifyAnswerBtn.classList.remove('d-none');
                    }
                }
                
                const isMarked = this.state.markedQuestions.includes(questionId);
                this.elements.markReviewBtn.classList.toggle('active', isMarked);
                this.elements.markReviewBtn.innerHTML = `<i class="fas fa-flag"></i> ${isMarked ? 'Â∑≤Ê®ôË®ò' : 'Ê®ôË®òÊ≠§È°å'}`;
                
                const progress = (Object.keys(this.state.userAnswers).length / this.state.questions.length) * 100;
                this.elements.progressBar.style.width = `${progress}%`;
                
                this.updateButtonStates();
                this.updateStats();
                return true;
            },
            
            
            // Êèê‰∫§Á≠îÊ°à
submitAnswer() {
                const selectedOption = document.querySelector('input[name="quiz-option"]:checked');
                if (!selectedOption) {
                    this.showAlert('Ë´ãÈÅ∏Êìá‰∏ÄÂÄãÁ≠îÊ°àÔºÅ', 'warning');
                    return false;
                }
                
                const question = this.state.questions[this.state.currentQuestionIndex];
                const questionId = this.state.currentQuestionIndex;
                
                // ÂÑ≤Â≠òÊàñÊõ¥Êñ∞Á≠îÊ°à
                this.state.userAnswers[questionId] = {
                    answer: selectedOption.value,
                    originalIndex: parseInt(selectedOption.dataset.originalIndex),
                    timestamp: new Date()
                };
                
                this.showAlert(`Á¨¨ ${question.number} È°åÁ≠îÊ°àÂ∑≤Êèê‰∫§`, 'success');

                // Âú®Á∑¥ÁøíÊàñË§áÁøíÊ®°Âºè‰∏ãÔºåÈ°ØÁ§∫Ëß£Êûê‰∏¶ÈéñÂÆöÈÅ∏È†Ö
                if (this.state.currentMode === 'practice' || this.state.currentMode === 'review') {
                    document.querySelectorAll('input[name="quiz-option"]').forEach(input => input.disabled = true);
                    const isCorrect = this.state.userAnswers[questionId].originalIndex === question.correct_answer_index;
                    this.showExplanation(question, this.state.userAnswers[questionId].answer, isCorrect);
                    this.elements.modifyAnswerBtn.classList.remove('d-none');
                }
                
                this.updateStats();
                this.updateButtonStates();
                this.saveUserData();
                return true;
            },
            
            // È°ØÁ§∫Ëß£Êûê
            showExplanation(question, userAnswerLetter, isCorrect) {
                this.elements.explanationBox.classList.remove('d-none');
                
                const questionId = this.state.currentQuestionIndex;
                const mapping = this.state.questionMapping[questionId];
                const correctAnswerLetter = mapping.correctLetter;
                
                const resultClass = isCorrect ? 'correct' : 'incorrect';
                const resultIcon = isCorrect ? '‚úÖ' : '‚ùå';
                const resultText = isCorrect ? 'Á≠îÂ∞ç‰∫ÜÔºÅ' : `Á≠îÈåØ‰∫ÜÔºÅÊ≠£Á¢∫Á≠îÊ°àÊòØ ${correctAnswerLetter}`;
                
                let explanationHTML = `
                    <div class="${resultClass} mb-3">
                        ${resultIcon} ${resultText}
                    </div>
                    <div class="fw-bold mb-2">Ëß£Êûê:</div>
                `;
                
                if (this.state.explanationMode === 'database') {
                    explanationHTML += `<div class="highlight">${question.explanation || 'ÁÑ°Ëß£Êûê'}</div>`;
                } else if (this.state.explanationMode === 'ai') {
                    explanationHTML += '<div class="highlight" id="ai-explanation">Ê≠£Âú®ÁîüÊàêËß£ÊûêÔºåË´ãÁ®çÂÄô...</div>';
                    this.generateAIExplanation(question, userAnswerLetter);
                }
                
                this.elements.explanationContent.innerHTML = explanationHTML;
                
                this.elements.topicBadge.textContent = question.topic || 'Êú™ÂàÜÈ°û';
                this.elements.subtopicBadge.textContent = question.subtopic || 'Êú™ÂàÜÈ°û';
            },
            

            
            // AIÁîüÊàêËß£Êûê
            async generateAIExplanation(question, userAnswerLetter) {
                try {
                    this.showLoading('AIÊ≠£Âú®ÁîüÊàêËß£Êûê...');
                    
                    const questionId = this.state.currentQuestionIndex;
                    const mapping = this.state.questionMapping[questionId];
                    const correctAnswerLetter = mapping ? mapping.correctLetter : question.correct_answer_letter;
                    
                    let optionsText = '';
                    if (mapping && mapping.shuffledOptions) {
                        optionsText = mapping.shuffledOptions.map((opt, idx) => 
                            `${String.fromCharCode(65 + idx)}. ${opt.text}`
                        ).join('\n');
                    } else {
                        optionsText = question.options.map((opt, i) => 
                            `${String.fromCharCode(65 + i)}. ${opt}`
                        ).join('\n');
                    }
                    
                    const prompt = `
                    ‰Ω†ÊòØ‰∏ÄÂÄãÂ∞àÊ•≠ÁöÑiPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´Ë™çË≠âËÄÉË©¶ËºîÂ∞éËÄÅÂ∏´„ÄÇË´ãÁî®ÁπÅÈ´î‰∏≠ÊñáÊ†πÊìö‰ª•‰∏ãÈ°åÁõÆÁîüÊàêË©≥Á¥∞ÁöÑÁ≠îÊ°àËß£ÊûêÔºà150Â≠ó‰ª•ÂÖßÔºâÔºö
                    
                    È°åÁõÆÔºö${question.question}
                    ÈÅ∏È†ÖÔºàÊåâÁî®Êà∂ÁúãÂà∞ÁöÑÈ†ÜÂ∫èÔºâ: 
                    ${optionsText}
                    Ê≠£Á¢∫Á≠îÊ°à: ${correctAnswerLetter}
                    Áî®Êà∂Á≠îÊ°à: ${userAnswerLetter}
                    
                    Ë´ãÊèê‰æõÊ∏ÖÊô∞ÂÆåÊï¥ÁöÑËß£ÈáãÔºåË™™ÊòéÁÇ∫‰ªÄÈ∫ºÊ≠£Á¢∫Á≠îÊ°àÊòØÊ≠£Á¢∫ÁöÑÔºå‰ª•ÂèäÁÇ∫‰ªÄÈ∫ºÂÖ∂‰ªñÈÅ∏È†ÖÊòØÈåØË™§ÁöÑ„ÄÇÈáçÈªûÈóúÊ≥®AIÊáâÁî®Ë¶èÂäÉÁöÑÂïÜÊ•≠ÂÉπÂÄºËàáÂØ¶ÂãôËÄÉÈáè„ÄÇ
                    `;

                    let aiExplanation = null;
                    
                    try {
                        const response = await fetch('https://back-9qb9.onrender.com/api/generate-explanation', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                model: this.state.selectedAIModel,
                                prompt: prompt,
                            }),
                            timeout: 10000
                        });

                        if (response.ok) {
                            const data = await response.json();
                            aiExplanation = data.explanation || data.response || data.answer;
                        }
                    } catch (error) {
                        console.warn('Ëá™ÂÆöÁæ©APIÂ§±ÊïóÔºåÂòóË©¶ÂÖ∂‰ªñÊñπÊ°à:', error);
                    }
                    
                    if (!aiExplanation) {
                        aiExplanation = this.generateMockAIExplanation(question, userAnswerLetter, correctAnswerLetter, mapping);
                    }
                    
                    this.hideLoading();
                    
                    const explanationElement = document.getElementById('ai-explanation');
                    if (explanationElement && aiExplanation) {
                        const paragraphs = aiExplanation.split('\n').filter(p => p.trim()).map(p => `<p>${p.trim()}</p>`).join('');
                        explanationElement.innerHTML = paragraphs;
                        
                        const aiLabel = document.createElement('div');
                        aiLabel.className = 'text-muted small mt-2';
                        aiLabel.innerHTML = '<i class="fas fa-robot me-1"></i>AIÁîüÊàêËß£Êûê';
                        explanationElement.appendChild(aiLabel);
                    } else {
                        this.fallbackToDatabaseExplanation();
                    }
                    
                } catch (error) {
                    console.error('AIËß£ÊûêÁîüÊàêÂ§±Êïó:', error);
                    this.hideLoading();
                    this.fallbackToDatabaseExplanation();
                }
            },
            
            // ÁîüÊàêÊ®°Êì¨AIËß£Êûê
            generateMockAIExplanation(question, userAnswerLetter, correctAnswerLetter, mapping) {
                const isCorrect = userAnswerLetter === correctAnswerLetter;
                const topic = question.topic || 'AIÊáâÁî®Ë¶èÂäÉ';
                const correctOptionText = mapping ? 
                    mapping.shuffledOptions.find(opt => opt.isCorrect)?.text || question.options[question.correct_answer_index] :
                    question.options[question.correct_answer_index];
                
                let explanation = '';
                
                if (isCorrect) {
                    explanation = `‚úÖ ÂõûÁ≠îÊ≠£Á¢∫ÔºÅ\n\n`;
                } else {
                    explanation = `‚ùå Ê≠§È°åÁ≠îÈåØ‰∫ÜÔºåÊ≠£Á¢∫Á≠îÊ°àÊòØ ${correctAnswerLetter}„ÄÇ\n\n`;
                }
                
                if (topic.includes('AIÊáâÁî®') || topic.includes('Ë¶èÂäÉ')) {
                    explanation += `Âú®AIÊáâÁî®Ë¶èÂäÉÈ†òÂüüÔºå„Äå${correctOptionText}„ÄçÊòØÊúÄ‰Ω≥ÈÅ∏ÊìáÔºåÂõ†ÁÇ∫Ôºö\n\n`;
                    explanation += `1. Á¨¶ÂêàiPASË™çË≠âÂ∞çAIÊáâÁî®Ë¶èÂäÉÂ∏´ÁöÑÊ†∏ÂøÉËÉΩÂäõË¶ÅÊ±Ç\n`;
                    explanation += `2. ÂèçÊò†‰∫ÜÊ•≠ÁïåÊúÄ‰Ω≥ÂØ¶ÂãôÂíåÂïÜÊ•≠ËÄÉÈáè\n`;
                    explanation += `3. ÊúâÂä©ÊñºÁ¢∫‰øùAIÂ∞àÊ°àÁöÑÊàêÂäüÂØ¶ÊñΩÂíåÂÉπÂÄºÂØ¶Áèæ\n\n`;
                } else if (topic.includes('Ê©üÂô®Â≠∏Áøí') || topic.includes('Ê®°Âûã')) {
                    explanation += `ÂæûÊäÄË°ìËßíÂ∫¶‰æÜÁúãÔºå„Äå${correctOptionText}„ÄçÊòØÊ≠£Á¢∫Á≠îÊ°àÔºåÂõ†ÁÇ∫Ôºö\n\n`;
                    explanation += `1. ÈÄôÊòØÊ©üÂô®Â≠∏ÁøíÈ†òÂüüÁöÑÈáçË¶ÅÊ¶ÇÂøµ\n`;
                    explanation += `2. Áõ¥Êé•ÂΩ±ÈüøÊ®°ÂûãÁöÑÂØ¶ÈöõÊáâÁî®ÊïàÊûú\n`;
                    explanation += `3. ÊòØAIÂ∞àÊ°àË©ï‰º∞ÁöÑÈóúÈçµÊåáÊ®ô\n\n`;
                } else {
                    explanation += `„Äå${correctOptionText}„ÄçÊòØÊ≠£Á¢∫Á≠îÊ°àÔºåÈÄôÂÄãÈÅ∏È†ÖÔºö\n\n`;
                    explanation += `1. Á¨¶ÂêàAIÊáâÁî®Ë¶èÂäÉÁöÑÂü∫Êú¨ÂéüÂâá\n`;
                    explanation += `2. È´îÁèæ‰∫ÜÂïÜÊ•≠ÂÉπÂÄºÂíåÂØ¶ÂãôËÄÉÈáè\n`;
                    explanation += `3. ÊòØiPASË™çË≠âËÄÉË©¶ÁöÑÈáçÈªûÂÖßÂÆπ\n\n`;
                }
                
                explanation += `Âª∫Ë≠∞ÈÄ≤‰∏ÄÊ≠•Ë§áÁøíÁõ∏ÈóúÁöÑ${topic}Áü•Ë≠òÈªûÔºåÂä†Âº∑Â∞çAIÊáâÁî®Ë¶èÂäÉÂØ¶ÂãôÁöÑÁêÜËß£„ÄÇ`;
                
                return explanation;
            },
            
            // ÂõûÈÄÄÂà∞Ë≥áÊñôÂ∫´Ëß£Êûê
            fallbackToDatabaseExplanation() {
                const explanationElement = document.getElementById('ai-explanation');
                if (explanationElement) {
                    const question = this.state.questions[this.state.currentQuestionIndex];
                    const databaseExplanation = question.explanation || 'Ê≠§È°åÁõÆÊö´ÁÑ°Ë©≥Á¥∞Ëß£Êûê„ÄÇ';
                    
                    explanationElement.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            AIËß£ÊûêÊúçÂãôÊö´ÊôÇ‰∏çÂèØÁî®ÔºåÂ∑≤ÂàáÊèõËá≥Ë≥áÊñôÂ∫´Ëß£Êûê
                        </div>
                        <div>${databaseExplanation}</div>
                        <div class="text-muted small mt-2">
                            <i class="fas fa-database me-1"></i>Ë≥áÊñôÂ∫´Ëß£Êûê
                        </div>
                    `;
                }
            },
            
            // ‰∏ã‰∏ÄÈ°å
nextQuestion() {
                if (this.state.currentQuestionIndex < this.state.questions.length - 1) {
                    this.state.currentQuestionIndex++;
                    this.displayQuestion();
                } else {
                    // Â¶ÇÊûúÂ∑≤Á∂ìÊòØÊúÄÂæå‰∏ÄÈ°åÔºåÂâáÊèêÁ§∫Áî®Êà∂ÊâãÂãïÈªûÊìäÂÆåÊàê
                    this.showAlert('Â∑≤Á∂ìÊòØÊúÄÂæå‰∏ÄÈ°å‰∫ÜÔºÅË´ãÈªûÊìä„ÄåÂÆåÊàê„ÄçÊåâÈàï‰æÜÁµêÊùüÊ∏¨È©ó„ÄÇ', 'info');
                }
            },
            
            // ‰∏ä‰∏ÄÈ°å
prevQuestion() {
                if (this.state.currentQuestionIndex > 0) {
                    this.state.currentQuestionIndex--;
                    this.displayQuestion();
                }
            },
            
            // ËøîÂõûÈ°åÂ∫´ÈÅ∏Êìá
            backToSelection() {
                // ËÄÉË©¶Ê®°Âºè‰∏ã‰∏çÂÖÅË®±ËøîÂõû
                if (this.state.currentMode === 'exam' && this.state.isQuizActive) {
                    this.showAlert('ËÄÉË©¶ÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïËøîÂõûÈ°åÂ∫´ÈÅ∏ÊìáÔºÅ', 'error');
                    return;
                }
                
                if (this.state.isQuizActive) {
                    const confirmBack = confirm('Á¢∫ÂÆöË¶ÅÊîæÊ£ÑÁï∂ÂâçÊ∏¨È©ó‰∏¶ËøîÂõûÈ°åÂ∫´ÈÅ∏ÊìáÂóéÔºü\nÈÄ≤Â∫¶Â∞á‰∏çÊúÉË¢´‰øùÂ≠ò„ÄÇ');
                    if (!confirmBack) {
                        return;
                    }
                }
                
                this.state.isQuizActive = false;
                this.unlockInterface();
                this.stopTimer();
                
                this.elements.quizContainer.classList.add('d-none');
                this.elements.settingsPanel.classList.remove('d-none');
                this.elements.quizStatus.style.display = 'none';
                this.elements.quizStatus.classList.remove('active');
                
                console.log('üîô Â∑≤ËøîÂõûÈ°åÂ∫´ÈÅ∏Êìá');
            },
            
            // ÂÆåÊàêÊ∏¨È©ó
finishQuiz() {
                const totalQuestions = this.state.questions.length;
                const answeredCount = Object.keys(this.state.userAnswers).length;
                const unansweredCount = totalQuestions - answeredCount;
                
                if (unansweredCount > 0) {
                    if (!confirm(`ÈÇÑÊúâ ${unansweredCount} È°åÊú™ÂõûÁ≠îÔºàÂ∞áË¶ñÁÇ∫Á≠îÈåØÔºâÔºåÁ¢∫ÂÆöË¶ÅÂÆåÊàêÊ∏¨È©óÂóéÔºü`)) {
                        return;
                    }
                }

                // Ê†∏ÂøÉ‰øÆÊîπÔºöÂú®È°ØÁ§∫ÁµêÊûúÂâçÔºåÊ†πÊìöÊúÄÁµÇÁ≠îÊ°àË®àÁÆóÂàÜÊï∏ÂíåÈåØÈ°å
                this.calculateFinalResults();
                
                this.stopTimer();
                this.state.isQuizActive = false;
                this.unlockInterface();
                this.syncPracticeRecord(); //Êñ∞Â¢ûÂêåÊ≠•ÂáΩÊï∏
                this.updateWrongQuestions();  //Êñ∞Â¢ûÈåØË™§È°åÁõÆ
                this.showResult();
                this.saveUserData(true);
                this.updateReviewButtonState();
            },
            
            // È°ØÁ§∫ÁµêÊûú
            showResult() {
                const total = this.state.questions.length;
                const score = this.state.score;
                const percentage = total > 0 ? (score / total * 100).toFixed(1) : 0;
                const duration = this.calculateTimeTaken();
                
                let resultHTML = `
                    <div class="text-center mb-4">
                        <h3>üìä ${this.state.currentMode === 'review' ? 'Ë§áÁøí' : 'Ê∏¨È©ó'}ÁµêÊûú</h3>
                        <div class="progress my-3" style="height: 25px;">
                            <div class="progress-bar ${percentage >= 70 ? 'bg-success' : 'bg-warning'}" 
                                 style="width: ${percentage}%">${percentage}%</div>
                        </div>
                    </div>
                    <div class="row text-center mb-4">
                        <div class="col-3">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h4 class="text-primary">${score}</h4>
                                    <small>ÂæóÂàÜ</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h4 class="text-info">${total}</h4>
                                    <small>Á∏ΩÈ°åÊï∏</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h4 class="text-warning">${percentage}%</h4>
                                    <small>Ê≠£Á¢∫Áéá</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h4 class="text-secondary">${duration}ÂàÜ</h4>
                                    <small>Áî®ÊôÇ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="alert ${percentage >= 70 ? 'alert-success' : 'alert-warning'} mb-4">
                        <h5 class="alert-heading">${percentage >= 70 ? 'üéâ ÊÅ≠ÂñúÈÄöÈÅéÔºÅ' : 'üí™ ÁπºÁ∫åÂä™ÂäõÔºÅ'}</h5>
                        <p class="mb-0">${percentage >= 70 ? 'ÈÅîÂà∞ÂÆòÊñπÂêàÊ†ºÊ®ôÊ∫ñ(70%)ÔºåËÄÉË©¶Ê∫ñÂÇôËâØÂ•ΩÔºÅ' : 'Ë∑ùÈõ¢ÂêàÊ†ºÊ®ôÊ∫ñÈÇÑÈúÄË¶ÅÂä†Âº∑ÔºåÂª∫Ë≠∞Â§öÂä†Á∑¥ÁøíÈåØÈ°å„ÄÇ'}</p>
                    </div>
                `;
                
                if (this.state.wrongQuestions.length > 0) {
                    resultHTML += this._generateWrongQuestionsHTML();
                }
                
                document.getElementById('result-content').innerHTML = resultHTML;
                this.modals.result.show();
            },

            // Ë®àÁÆóÊ∏¨È©óÊôÇÈñì
            calculateTimeTaken() {
                if (this.state.startTime) {
                    return Math.round((new Date() - this.state.startTime) / 1000 / 60);
                }
                return 0;
            },

            // Áî¢ÁîüÈåØÈ°åÂàÜÊûêHTML
            _generateWrongQuestionsHTML() {
                let wrongQuestionsHTML = `
                    <div class="card mt-4">
                        <div class="card-header bg-danger text-white">
                            <h5 class="mb-0">‚ùå ÈåØÈ°åÂàÜÊûê (${this.state.wrongQuestions.length}È°å)</h5>
                        </div>
                        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                `;
                
                const topicWrongs = {};
                this.state.wrongQuestions.forEach(q => {
                    const topic = q.topic || 'Êú™ÂàÜÈ°û';
                    if (!topicWrongs[topic]) topicWrongs[topic] = [];
                    topicWrongs[topic].push(q);
                });

                for (const [topic, questions] of Object.entries(topicWrongs)) {
                    wrongQuestionsHTML += `<div class="mb-4"><h6 class="border-bottom pb-2">„Äê${topic}„Äë: ${questions.length}È°å</h6>`;
                    questions.forEach((q, index) => {
                        const qOriginalIndex = this.state.questions.indexOf(q);
                        const userAnswerData = this.state.userAnswers[qOriginalIndex];
                        const qMapping = this.state.questionMapping[qOriginalIndex];
                        const qId = `wrong-q-detail-${topic.replace(/\s+/g, '-')}-${index}`;
                        
                        let userAnswerText = 'Êú™‰ΩúÁ≠î', correctAnswerLetter = q.correct_answer_letter, correctAnswerText = q.options[q.correct_answer_index];

                        if (userAnswerData && qMapping) {
                            const userSelectedOpt = qMapping.shuffledOptions.find(opt => 
                                opt.originalIndex === userAnswerData.originalIndex
                            );
                            if (userSelectedOpt) userAnswerText = userSelectedOpt.text;
                            correctAnswerLetter = qMapping.correctLetter;
                        } else if (userAnswerData) {
                            userAnswerText = q.options[userAnswerData.originalIndex] || 'Êú™Áü•';
                        }
                        
                        wrongQuestionsHTML += `
                            <div class="mb-3">
                                <a class="fw-bold text-decoration-none text-dark" data-bs-toggle="collapse" href="#${qId}">
                                    ${index+1}. ${q.question}
                                </a>
                                <div class="ps-3 mt-1">
                                    <div class="text-danger">ÊÇ®ÁöÑÁ≠îÊ°à: ${userAnswerData ? userAnswerData.answer : 'Êú™‰ΩúÁ≠î'} (${userAnswerText})</div>
                                    <div class="text-success">Ê≠£Á¢∫Á≠îÊ°à: ${correctAnswerLetter} (${correctAnswerText})</div>
                                    <div class="collapse mt-2" id="${qId}">
                                        <div class="card card-body bg-light">
                                            <h6 class="text-primary mb-2">È°åÁõÆËß£Êûê:</h6>
                                            ${q.explanation || 'ÁÑ°Ëß£Êûê'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    wrongQuestionsHTML += `</div>`;
                }
                wrongQuestionsHTML += `</div></div>`;
                return wrongQuestionsHTML;
            },
            
            // Ë§áÁøíÈåØÈ°å
            reviewWrongQuestions() {
                if (this.state.wrongQuestions.length === 0) {
                    this.showAlert('Ê≤íÊúâÈåØÈ°åÈúÄË¶ÅË§áÁøí', 'info');
                    return;
                }
                
                this.modals.result.hide();
                this.state.currentMode = 'review';
                this.state.selectedReviewMode = 'wrong';
                
                this.state.questions = [...this.state.wrongQuestions];
                this.state.currentQuestionIndex = 0;
                this.state.score = 0;
                this.state.userAnswers = {};
                this.state.markedQuestions = []; // Êñ∞Â¢ûÈÄô‰∏ÄË°å
                this.state.questionMapping = {};
                this.state.wrongQuestions = [];
                
                this.state.questions.forEach((q, index) => q.number = index + 1);
                
                this.displayQuestion();
                this.updateButtonStates();
                this.showAlert('ÈñãÂßãË§áÁøíÈåØÈ°å', 'success');
            },
            
            // ÈáçÊñ∞Ê∏¨È©ó
            restartQuiz() {
                this.modals.result.hide();
                this.state.isQuizActive = false;
                this.stopTimer();
                this.unlockInterface();
                this.elements.quizContainer.classList.add('d-none');
                this.elements.settingsPanel.classList.remove('d-none');
                this.elements.quizStatus.style.display = 'none';
                this.elements.quizStatus.classList.remove('active');
                
                this.state.currentQuestionIndex = 0;
                this.state.userAnswers = {};
                this.state.markedQuestions = []; // Êñ∞Â¢ûÈÄô‰∏ÄË°å
                this.state.questionMapping = {};
                this.state.score = 0;
                this.state.wrongQuestions = [];
                this.state.questions = [];
                this.state.startTime = null;
                
                if (this.state.selectedDatabase) this.elements.startBtn.disabled = false;
                this.showAlert('ÂèØ‰ª•ÈáçÊñ∞ÈÅ∏ÊìáÈ°åÁõÆÊï∏ÈáèÂíåÊ∏¨È©óË®≠ÂÆö‰∫ÜÔºÅ', 'success');
            },
            
            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
updateButtonStates() {
                const hasAnswered = this.state.currentQuestionIndex in this.state.userAnswers;
                const isFirst = this.state.currentQuestionIndex === 0;
                const isLast = this.state.currentQuestionIndex === this.state.questions.length - 1;
                const isPracticeOrReview = this.state.currentMode === 'practice' || this.state.currentMode === 'review';

                // ‰∏ä‰∏ÄÈ°åÔºöÂè™Ë¶Å‰∏çÊòØÁ¨¨‰∏ÄÈ°åÔºåÂ∞±ÂèØÁî®
                this.elements.prevBtn.disabled = isFirst;
                
                // Êèê‰∫§ÔºöÂú®Á∑¥Áøí/Ë§áÁøíÊ®°Âºè‰∏ãÔºåÁ≠îÈÅéÂ∞±Á¶ÅÁî®„ÄÇËÄÉË©¶Ê®°Âºè‰∏ãÊÅÜÂÆöÂèØÁî®„ÄÇ
                this.elements.submitBtn.disabled = hasAnswered && isPracticeOrReview;

                // ‰∏ã‰∏ÄÈ°åÔºöÂè™Ë¶Å‰∏çÊòØÊúÄÂæå‰∏ÄÈ°åÔºåÂ∞±ÂèØÁî®
                this.elements.nextBtn.disabled = isLast;

                // ÂÆåÊàêÔºöÊÅÜÂÆöÂèØÁî®
                this.elements.finishBtn.disabled = false;
            },

            // Ë®àÁÆóÂÆåÊàêÊåâÈàïÁãÄÊÖã
            calculateFinishButtonState() {
                const totalQuestions = this.state.questions.length;
                const answeredCount = Object.keys(this.state.userAnswers).length;
                
                switch (this.state.currentMode) {
                    case 'exam':
                        return answeredCount === totalQuestions || !this.state.isTimerRunning;
                    case 'practice':
                        const practiceMinimum = Math.ceil(totalQuestions * 0.5);
                        return answeredCount >= practiceMinimum;
                    case 'review':
                        const reviewMinimum = Math.ceil(totalQuestions * 0.3);
                        return answeredCount >= reviewMinimum;
                    default:
                        return false;
                }
            },

            // Êõ¥Êñ∞ÂÆåÊàêÊåâÈàïÊñáÂ≠ó
            updateFinishButtonText() {
                const totalQuestions = this.state.questions.length;
                const answeredCount = Object.keys(this.state.userAnswers).length;
                const finishBtn = this.elements.finishBtn;
                
                if (finishBtn.disabled) {
                    let requiredCount;
                    let modeText;
                    
                    switch (this.state.currentMode) {
                        case 'exam':
                            requiredCount = totalQuestions;
                            modeText = 'Ê®°Êì¨ËÄÉË©¶ÈúÄÂõûÁ≠îÊâÄÊúâÈ°åÁõÆ';
                            break;
                        case 'practice':
                            requiredCount = Math.ceil(totalQuestions * 0.5);
                            modeText = 'Á∑¥ÁøíÊ®°ÂºèÈúÄÂõûÁ≠îËá≥Â∞ë50%';
                            break;
                        case 'review':
                            requiredCount = Math.ceil(totalQuestions * 0.3);
                            modeText = 'Ë§áÁøíÊ®°ÂºèÈúÄÂõûÁ≠îËá≥Â∞ë30%';
                            break;
                        default:
                            requiredCount = totalQuestions;
                            modeText = 'ÈúÄÂõûÁ≠îÊõ¥Â§öÈ°åÁõÆ';
                    }
                    
                    finishBtn.title = `${modeText} (${answeredCount}/${requiredCount})`;
                    finishBtn.innerHTML = `
                        <i class="fas fa-flag-checkered me-1"></i> 
                        <span class="d-none d-sm-inline">ÂÆåÊàê (${answeredCount}/${requiredCount})</span>
                    `;
                } else {
                    finishBtn.title = 'ÂèØ‰ª•ÂÆåÊàêÊ∏¨È©ó‰∫ÜÔºÅ';
                    finishBtn.innerHTML = `
                        <i class="fas fa-flag-checkered me-1"></i> 
                        <span class="d-none d-sm-inline">ÂÆåÊàêÊ∏¨È©ó</span>
                    `;
                }
            },

            // Êñ∞Â¢ûÔºöÂÖÅË®±‰øÆÊîπÁ≠îÊ°à
            enableAnswerModification() {
                this.elements.explanationBox.classList.add('d-none');
                this.elements.modifyAnswerBtn.classList.add('d-none');
                document.querySelectorAll('input[name="quiz-option"]').forEach(input => {
                    input.disabled = false;
                });
                this.elements.submitBtn.disabled = false;
                this.elements.nextBtn.disabled = true;
                this.showAlert('ÊÇ®ÂèØ‰ª•‰øÆÊîπÁ≠îÊ°à‰∫ÜÔºå‰øÆÊîπÂæåË´ãÈáçÊñ∞Êèê‰∫§„ÄÇ', 'info');
            },

            // Êñ∞Â¢ûÔºöÊ®ôË®ò/ÂèñÊ∂àÊ®ôË®òÈ°åÁõÆ
            toggleMarkForReview() {
                const index = this.state.currentQuestionIndex;
                const markedIndex = this.state.markedQuestions.indexOf(index);

                if (markedIndex > -1) {
                    this.state.markedQuestions.splice(markedIndex, 1);
                    this.elements.markReviewBtn.classList.remove('active');
                    this.elements.markReviewBtn.innerHTML = '<i class="fas fa-flag"></i> Ê®ôË®òÊ≠§È°å';
                } else {
                    this.state.markedQuestions.push(index);
                    this.elements.markReviewBtn.classList.add('active');
                    this.elements.markReviewBtn.innerHTML = '<i class="fas fa-flag"></i> Â∑≤Ê®ôË®ò';
                }
            },

            // Êñ∞Â¢ûÔºöÈ°ØÁ§∫È°åËôüÁ∏ΩË¶ΩÊ®°ÊÖãÊ°Ü
            showOverviewModal() {
                const grid = document.getElementById('overview-grid');
                grid.innerHTML = '';
                
                for (let i = 0; i < this.state.questions.length; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'btn overview-q-btn';
                    btn.textContent = i + 1;
                    
                    if (i === this.state.currentQuestionIndex) {
                        btn.classList.add('current');
                    }
                    if (i in this.state.userAnswers) {
                        btn.classList.add('answered');
                    }
                    if (this.state.markedQuestions.includes(i)) {
                        const flag = document.createElement('i');
                        flag.className = 'fas fa-flag';
                        btn.appendChild(flag);
                        btn.classList.add('marked');
                    }
                    
                    btn.addEventListener('click', () => {
                        this.jumpToQuestion(i);
                    });
                    
                    grid.appendChild(btn);
                }
                this.modals.overview.show();
            },

            // Êñ∞Â¢ûÔºöË∑≥ËΩâÂà∞ÊåáÂÆöÈ°åÁõÆ
            jumpToQuestion(index) {
                this.state.currentQuestionIndex = index;
                this.displayQuestion();
                this.modals.overview.hide();
            },

            // Êñ∞Â¢ûÔºöË®àÁÆóÊúÄÁµÇÁµêÊûúÁöÑÁç®Á´ãÂáΩÂºè
            calculateFinalResults() {
                this.state.score = 0;
                this.state.wrongQuestions = [];
                const sessionCorrectQuestions = new Set();
                const sessionIncorrectQuestions = new Set();

                this.state.questions.forEach((question, index) => {
                    const userAnswerData = this.state.userAnswers[index];
                    const isCorrect = userAnswerData ? userAnswerData.originalIndex === question.correct_answer_index : false;
                    
                    if (isCorrect) {
                        this.state.score++;
                        sessionCorrectQuestions.add(question.question);
                    } else {
                        this.state.wrongQuestions.push(question);
                        sessionIncorrectQuestions.add(question.question);
                    }

                    // Ë®òÈåÑÊú¨Ê¨°‰ΩúÁ≠îÊ≠∑Âè≤
                    if (userAnswerData) {
                         const mapping = this.state.questionMapping[index];
                         const historyEntry = {
                            timestamp: new Date().toISOString(),
                            database: this.state.selectedDatabase,
                            question: question.question,
                            options: question.options,
                            user_answer: userAnswerData.answer,
                            correct_answer_letter: mapping ? mapping.correctLetter : 'N/A',
                            is_correct: isCorrect,
                            topic: question.topic,
                            subtopic: question.subtopic,
                            explanation: question.explanation
                        };
                        this.state.userData.history.push(historyEntry);
                    }
                });

                // Êõ¥Êñ∞ÂÖ®ÂüüÁöÑÂ∞çÈåØÈ°åË®òÈåÑ
                // 1. Â∞áÊú¨Ê¨°Á≠îÂ∞çÁöÑÈ°åÁõÆÔºåÂæûÂÖ®ÂüüÈåØÈ°å‰∏≠ÁßªÈô§
                this.state.userData.incorrect = (this.state.userData.incorrect || []).filter(q => !sessionCorrectQuestions.has(q));
                // 2. Â∞áÊú¨Ê¨°Á≠îÈåØÁöÑÈ°åÁõÆÔºåÂä†ÂÖ•ÂÖ®ÂüüÈåØÈ°å‰∏≠ (ÂéªÈáç)
                this.state.userData.incorrect = [...new Set([...(this.state.userData.incorrect || []), ...sessionIncorrectQuestions])];
            },

            
            // Êõ¥Êñ∞Áµ±Ë®àÈ°ØÁ§∫
updateStats() {
                let score = 0;
                const answered = Object.keys(this.state.userAnswers).length;
                for (const index in this.state.userAnswers) {
                    const question = this.state.questions[index];
                    const userAnswer = this.state.userAnswers[index];
                    if (userAnswer.originalIndex === question.correct_answer_index) {
                        score++;
                    }
                }
                const percentage = answered > 0 ? (score / answered * 100).toFixed(1) : 0;
                this.elements.statsDisplay.textContent = `ÂæóÂàÜ: ${score}/${answered} (${percentage}%)`;
            },
            
            // È°ØÁ§∫Áµ±Ë®àË≥áÊñô
            showStatistics() {
                const correctCount = this.state.userData.correct ? this.state.userData.correct.length : 0;
                const incorrectCount = this.state.userData.incorrect ? this.state.userData.incorrect.length : 0;
                const totalAnswered = correctCount + incorrectCount;
                const accuracy = totalAnswered > 0 ? (correctCount / totalAnswered) * 100 : 0;
                
                const databaseStats = {};
                (this.state.userData.history || []).forEach(entry => {
                    const db = entry.database || 'Êú™Áü•';
                    if (!databaseStats[db]) {
                        databaseStats[db] = { correct: 0, total: 0 };
                    }
                    databaseStats[db].total += 1;
                    if (entry.is_correct) {
                        databaseStats[db].correct += 1;
                    }
                });
                
const topicStats = {};
        (this.state.userData.history || []).forEach(entry => {
            const topic = entry.topic || 'Êú™ÂàÜÈ°û';
            if (!topicStats[topic]) {
                topicStats[topic] = { correct: 0, total: 0 };
            }
            topicStats[topic].total += 1;
            if (entry.is_correct) {
                topicStats[topic].correct += 1;
            }
        });
         
                let statsHTML = `
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h4>${correctCount}</h4>
                                    <p class="mb-0">Á≠îÂ∞çÈ°åÊï∏</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <h4>${incorrectCount}</h4>
                                    <p class="mb-0">Á≠îÈåØÈ°åÊï∏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">Êï¥È´îË°®Áèæ</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Á∏ΩÁ≠îÈ°åÊï∏:</strong> ${totalAnswered}</p>
                                    <p><strong>Êï¥È´îÊ≠£Á¢∫Áéá:</strong> ${accuracy.toFixed(1)}%</p>
                                </div>
                                <div class="col-md-6">
                                    <div class="progress" style="height: 30px;">
                                        <div class="progress-bar ${accuracy >= 70 ? 'bg-success' : 'bg-warning'}" style="width: ${accuracy}%">
                                            ${accuracy.toFixed(1)}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">ÂêÑÈ°åÂ∫´Ë°®Áèæ</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>È°åÂ∫´</th>
                                            <th>Ê≠£Á¢∫Áéá</th>
                                            <th>Ê≠£Á¢∫/Á∏ΩÊï∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                Object.keys(databaseStats).forEach(db => {
                    const stats = databaseStats[db];
                    const dbAccuracy = stats.total > 0 ? (stats.correct / stats.total) * 100 : 0;
                    const config = this.examConfigs[db];
                    const dbName = config ? config.name : db;
                    
                    statsHTML += `
                        <tr>
                            <td>${dbName}</td>
                            <td>
                                <div class="progress" style="height: 15px;">
                                    <div class="progress-bar ${dbAccuracy < 60 ? 'bg-danger' : dbAccuracy < 80 ? 'bg-warning' : 'bg-success'}" 
                                         style="width: ${dbAccuracy}%;"></div>
                                </div>
                                ${dbAccuracy.toFixed(1)}%
                            </td>
                            <td>${stats.correct}/${stats.total}</td>
                        </tr>
                    `;
                });
                
                if (Object.keys(databaseStats).length === 0) {
                    statsHTML += '<tr><td colspan="3" class="text-center">Â∞öÊú™ÊúâÁ∑¥ÁøíË®òÈåÑ</td></tr>';
                }
                
                statsHTML += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">‰∏ªÈ°åÂàÜÊûê</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>‰∏ªÈ°å</th>
                                            <th>Ê≠£Á¢∫Áéá</th>
                                            <th>Âª∫Ë≠∞</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;
                
                Object.keys(topicStats).forEach(topic => {
                    const stats = topicStats[topic];
                    const topicAccuracy = stats.total > 0 ? (stats.correct / stats.total) * 100 : 0;
                    let suggestion = '';
                    
                    if (topicAccuracy < 60) {
                        suggestion = 'üî¥ ÈáçÈªûÂä†Âº∑';
                    } else if (topicAccuracy < 80) {
                        suggestion = 'üü° ÊåÅÁ∫åÁ∑¥Áøí';
                    } else {
                        suggestion = 'üü¢ Ë°®ÁèæËâØÂ•Ω';
                    }
                    
                    statsHTML += `
                        <tr>
                            <td>${topic}</td>
                            <td>
                                <div class="progress" style="height: 15px;">
                                    <div class="progress-bar ${topicAccuracy < 60 ? 'bg-danger' : topicAccuracy < 80 ? 'bg-warning' : 'bg-success'}" 
                                         style="width: ${topicAccuracy}%;"></div>
                                </div>
                                ${topicAccuracy.toFixed(1)}%
                            </td>
                            <td>${suggestion}</td>
                        </tr>
                    `;
                });
                
                if (Object.keys(topicStats).length === 0) {
                    statsHTML += '<tr><td colspan="3" class="text-center">Â∞öÊú™ÊúâÁ∑¥ÁøíË®òÈåÑ</td></tr>';
                }
                
                statsHTML += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('stats-content').innerHTML = statsHTML;
                this.modals.stats.show();
            },
            
            // ÂåØÂá∫ÈåØÈ°å
            exportWrongQuestions() {
                if (!this.state.userData.incorrect || this.state.userData.incorrect.length === 0) {
                    this.showAlert('ÁõÆÂâçÊ≤íÊúâÈåØÈ°åË®òÈåÑ', 'info');
                    return;
                }
                
                let exportText = "iPAS AIÊáâÁî®Ë¶èÂäÉÂ∏´Ë™çË≠âËÄÉË©¶ÈåØÈ°åÈõÜ\n";
                exportText += `ÂåØÂá∫ÊôÇÈñì: ${new Date().toLocaleString()}\n`;
                exportText += `Á∏ΩÈåØÈ°åÊï∏: ${this.state.userData.incorrect.length}\n\n`;
                exportText += "=".repeat(50) + "\n\n";
                
                const incorrectQuestions = this.state.userData.incorrect;
                const questionData = {};
                
                (this.state.userData.history || []).forEach(entry => {
                    if (incorrectQuestions.includes(entry.question) && !questionData[entry.question]) {
                        questionData[entry.question] = entry;
                    }
                });
                
                incorrectQuestions.forEach((questionText, i) => {
                    exportText += `„ÄêÈ°åÁõÆ ${i+1}„Äë\n${questionText}\n\n`;
                    
                    if (questionData[questionText]) {
                        const data = questionData[questionText];
                        
                        const options = data.options || [];
                        if (options.length > 0) {
                            exportText += "ÈÅ∏È†Ö:\n";
                            options.forEach((option, j) => {
                                exportText += `${String.fromCharCode(65+j)}. ${option}\n`;
                            });
                            exportText += "\n";
                        }
                        
                        exportText += `Ê≠£Á¢∫Á≠îÊ°à: ${data.correct_answer_letter || 'Êú™Áü•'}\n`;
                        exportText += `ÊÇ®ÁöÑÁ≠îÊ°à: ${data.user_answer || 'Êú™Áü•'}\n`;
                        const config = this.examConfigs[data.database];
                        exportText += `È°åÂ∫´‰æÜÊ∫ê: ${config ? config.name : data.database}\n`;
                        exportText += `‰∏ªÈ°åÂàÜÈ°û: ${data.topic || 'Êú™ÂàÜÈ°û'} > ${data.subtopic || 'Êú™ÂàÜÈ°û'}\n`;
                        
                        if (data.explanation) {
                            exportText += `Ëß£Êûê: ${data.explanation}\n`;
                        }
                    }
                    
                    exportText += "\n" + "-".repeat(50) + "\n\n";
                });
                
                exportText += "\nÂª∫Ë≠∞Âæ©ÁøíÈáçÈªû:\n";
                exportText += "1. ÈáçÈªûÈóúÊ≥®Á≠îÈåØÁéáÈ´òÁöÑ‰∏ªÈ°å\n";
                exportText += "2. ÁêÜËß£È°åÁõÆËÉåÂæåÁöÑÂïÜÊ•≠ÈÇèËºØ\n";
                exportText += "3. Âä†Âº∑AIÊáâÁî®Ë¶èÂäÉÁöÑÂØ¶ÂãôÁü•Ë≠ò\n";
                exportText += "4. ÂÆöÊúüÂõûÈ°ßÈåØÈ°åÔºåÈÅøÂÖçÈáçË§áÁäØÈåØ\n";
                
                const filename = `iPAS_AIÊáâÁî®Ë¶èÂäÉÂ∏´_ÈåØÈ°åÈõÜ_${new Date().toISOString().slice(0,19).replace(/[-:T]/g, '')}.txt`;
                const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
                
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                this.showAlert(`ÈåØÈ°åÂ∑≤ÂåØÂá∫Ëá≥ ${filename}`, 'success');
            },
            
            // ÈáçÁΩÆÂ≠∏ÁøíÈÄ≤Â∫¶
            resetProgress() {
                if (confirm('Á¢∫ÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÂ≠∏ÁøíÈÄ≤Â∫¶ÂóéÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÈÄÜ„ÄÇ\n\nÂ∞áÊ∏ÖÈô§Ôºö\n- ÊâÄÊúâÁ≠îÈ°åË®òÈåÑ\n- ÈåØÈ°åÁµ±Ë®à\n- Â≠∏ÁøíÊ≠∑Âè≤')) {
                    this.state.userData = {
                        correct: [],
                        incorrect: [],
                        history: [],
                        databaseStats: {}
                    };
                    this.saveUserData();
                    this.updateReviewButtonState();
                    this.modals.stats.hide();
                    this.showAlert('Â≠∏ÁøíÈÄ≤Â∫¶Â∑≤ÈáçÁΩÆ', 'success');
                }
            },
            
            // Ë®àÊôÇÂô®ÂäüËÉΩ
            startTimer() {
                this.state.isTimerRunning = true;
                this.state.startTime = new Date();
                this.elements.quizTimerDisplay.style.display = 'block';
                this.updateTimer();
            },
            
            stopTimer() {
                this.state.isTimerRunning = false;
                this.elements.quizTimerDisplay.style.display = 'none';
                if (this.state.timerId) {
                    clearTimeout(this.state.timerId);
                    this.state.timerId = null;
                }
            },
            
            updateTimer() {
                if (!this.state.isTimerRunning) {
                    return;
                }
                
                const currentTime = new Date();
                const elapsedSeconds = Math.floor((currentTime - this.state.startTime) / 1000);
                const remainingSeconds = (this.state.examDuration * 60) - elapsedSeconds;
                
                if (remainingSeconds <= 0) {
                    this.updateTimerDisplay('00:00');
                    this.elements.quizTimerDisplay.classList.add('warning');
                    this.stopTimer();
                    this.showAlert('‚è∞ ËÄÉË©¶ÊôÇÈñìÁµêÊùüÔºÅÁ≥ªÁµ±Â∞áËá™Âãï‰∫§Âç∑‰∏¶Ë®àÁÆóÊàêÁ∏æ„ÄÇ', 'warning');
                    this.finishQuiz();
                    return;
                }
                
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                this.updateTimerDisplay(timeString);
                
                if (minutes < 5) {
                    this.elements.quizTimerDisplay.classList.add('warning');
                } else {
                    this.elements.quizTimerDisplay.classList.remove('warning');
                }
                
                this.state.timerId = setTimeout(() => this.updateTimer(), 1000);
            },
            
            updateTimerDisplay(timeString) {
                this.elements.quizTimerDisplay.innerHTML = `<i class="fas fa-clock me-2"></i>Ââ©È§òÊôÇÈñì: ${timeString}`;
            },
            
            // È°ØÁ§∫ÊèêÁ§∫Ë®äÊÅØ
            showAlert(message, type = 'info') {
                const alertTypes = {
                    'success': 'alert-success',
                    'error': 'alert-danger', 
                    'warning': 'alert-warning',
                    'info': 'alert-info'
                };
                
                const alertClass = alertTypes[type] || 'alert-info';
                const iconMap = {
                    'success': 'fa-check-circle',
                    'error': 'fa-exclamation-triangle',
                    'warning': 'fa-exclamation-triangle', 
                    'info': 'fa-info-circle'
                };
                const icon = iconMap[type] || 'fa-info-circle';
                
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
                alertDiv.style.cssText = `
                    top: 100px; 
                    right: 20px; 
                    z-index: 9999; 
                    min-width: 300px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                `;
                alertDiv.innerHTML = `
                    <i class="fas ${icon} me-2"></i>${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            },
            
            // È°ØÁ§∫Âä†ËºâÂãïÁï´
            showLoading(text = 'ËôïÁêÜ‰∏≠...') {
                this.elements.loadingText.textContent = text;
                this.elements.loadingOverlay.classList.remove('d-none');
            },
            
            // Èö±ËóèÂä†ËºâÂãïÁï´
            hideLoading() {
                this.elements.loadingOverlay.classList.add('d-none');
            },
// ‚ú®‚ú®‚ú® Êñ∞Â¢ûÊï∏ÊìöÂêåÊ≠•Ê†∏ÂøÉÂáΩÊï∏ ‚ú®‚ú®‚ú®
    async syncPracticeRecord() {
        const generalUserData = JSON.parse(localStorage.getItem('user_data') || '{}');
        const lineUserData = JSON.parse(localStorage.getItem('ipas_user_data') || '{}');
        const userId = generalUserData.google_id || generalUserData.userId || lineUserData.userId;

        if (!userId) {
            this.showAlert('‚ùå Ë≠¶ÂëäÔºöÊú™ÁôªÂÖ•ÔºåË®òÈåÑÂ∞á‰∏çÊúÉ‰∏äÂÇ≥Èõ≤Á´ØÔºÅ', 'warning');
            return;
        }

        if (!this.state.questions || this.state.questions.length === 0) {
            return;
        }
        
        // 1. ÁµÑË£ùË¶ÅÂÇ≥ÈÄÅÁöÑË≥áÊñô
        const totalQuestions = this.state.questions.length;
        
        // Â∞á answers ËΩâÊèõÁÇ∫ n8n Code ÁØÄÈªûÊúüÊúõÁöÑÊ†ºÂºè
        const answersData = Object.keys(this.state.userAnswers).map(index => {
            const q = this.state.questions[index];
            const answer = this.state.userAnswers[index];
            const isCorrect = answer.originalIndex === q.correct_answer_index;
            return {
                q_index: parseInt(index),
                user_answer: answer.answer,
                user_original_index: answer.originalIndex, // Â¢ûÂä†ÂéüÂßãÁ¥¢Âºï
                is_correct: isCorrect,
                time: answer.timestamp.toISOString() // ‰ΩøÁî® ISO Â≠ó‰∏≤
            };
        });

        const accuracy = totalQuestions > 0 ? (this.state.score / totalQuestions * 100).toFixed(2) : 0;

        const syncPayload = {
            userId: userId, // ‰ΩøÁî®ÈÄöÁî® userId
            databaseType: this.state.selectedDatabase,
            questionCount: totalQuestions,
            startTime: this.state.startTime ? this.state.startTime.toISOString() : new Date().toISOString(),
            endTime: new Date().toISOString(),
            score: this.state.score,
            accuracy: parseFloat(accuracy),
            answers: answersData, // ÂÇ≥ÈÄÅÊï¥ÁêÜÂæåÁöÑÁ≠îÊ°àÈô£Âàó
            markedQuestions: this.state.markedQuestions // ÂÇ≥ÈÄÅÊ®ôË®òÁöÑÈ°åÁõÆ
        };

        // 2. Ë®≠ÂÆö n8n Webhook URL
        const webhookUrl = 'https://nickleo9.zeabur.app/webhook/save-practice-record'; 

        this.showLoading('ÂêåÊ≠•Á∑¥ÁøíË®òÈåÑ‰∏≠...');

        try {
            const response = await fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(syncPayload)
            });

            this.hideLoading();
            
            if (response.ok) {
                const result = await response.json();
                this.showAlert(`‚úÖ Ë®òÈåÑÂêåÊ≠•ÊàêÂäüÔºÅÂàÜÊï∏: ${syncPayload.score}/${syncPayload.questionCount} (${syncPayload.accuracy}%)`, 'success');
                console.log('‚úÖ Supabase ÂêåÊ≠•ÁµêÊûú:', result);
            } else {
                this.showAlert('‚ö†Ô∏è Èõ≤Á´ØÂêåÊ≠•Â§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÊàñÂæåÂè∞ÊúçÂãô„ÄÇ', 'error');
                console.error('‚ùå Supabase ÂêåÊ≠•ÈåØË™§:', response.status, await response.text());
            }

        } catch (error) {
            this.hideLoading();
            this.showAlert('üö® Á∂≤Ë∑ØÈåØË™§ÔºåÁ∑¥ÁøíË®òÈåÑÊú™‰∏äÂÇ≥„ÄÇ', 'error');
            console.error('üö® Á∂≤Ë∑ØÈåØË™§:', error);
        }
    },   // <-- ÈÄôÊòØ syncPracticeRecord ÂáΩÂºèÁöÑÁµêÊùü

async updateWrongQuestions() {
    const generalUserData = JSON.parse(localStorage.getItem('user_data') || '{}');
    const lineUserData = JSON.parse(localStorage.getItem('ipas_user_data') || '{}');
    const userId = generalUserData.google_id || generalUserData.userId || lineUserData.userId;
    
    if (!userId) {
        console.log('‚ö†Ô∏è Êú™ÁôªÂÖ•,‰∏çË®òÈåÑÈåØÈ°å');
        return;
    }
    
    if (Object.keys(this.state.userAnswers).length === 0) {
        console.log('‚ö†Ô∏è Ê≤íÊúâÁ≠îÈ°åË®òÈåÑ');
        return;
    }
    
    try {
        console.log('üì§ ÈñãÂßãÊõ¥Êñ∞ÈåØÈ°åÈõÜ...');
        
        const wrongQuestionsData = {
            userId: userId,
            databaseType: this.state.selectedDatabase,
            answers: this.state.userAnswers,
            questions: this.state.questions,
            timestamp: new Date().toISOString()
        };
        
        const response = await fetch('https://nickleo9.zeabur.app/webhook/update-wrong-questions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(wrongQuestionsData)
        });
        
        if (response.ok) {
            const result = await response.json();
            console.log('‚úÖ ÈåØÈ°åÈõÜÊõ¥Êñ∞ÊàêÂäü:', result);
        } else {
            console.error('‚ùå ÈåØÈ°åÈõÜÊõ¥Êñ∞Â§±Êïó:', response.statusText);
        }
    } catch (error) {
        console.error('‚ùå Êõ¥Êñ∞ÈåØÈ°åÈõÜÈåØË™§:', error);
    }
}

            
            
        };  // <--- ÈÄôÊòØ iPASQuizApp Áâ©‰ª∂ÁöÑÁµêÊùü
        
        // ÂàùÂßãÂåñÊáâÁî®
        document.addEventListener('DOMContentLoaded', () => {
            iPASQuizApp.init();
        });
        
        </script>  <!-- ‚Üê ÈÄôË£°ÁµêÊùü‰∏ä‰∏ÄÂÄã script -->
    <!-- ‚ú® Êñ∞Â¢ûÔºöÁôªÂÖ•ÂäüËÉΩ JavaScript START -->
    <script>
        // ==================== ÁôªÂÖ•ÁÆ°ÁêÜÁ≥ªÁµ± (LoginManager) ====================

        const UsageManager = {
    checkDailyUsage() {
        const today = new Date().toDateString();
        const usageKey = `daily_usage_${today}`;
        return parseInt(localStorage.getItem(usageKey) || '0');
    },
    
    incrementUsage() {
        const today = new Date().toDateString();
        const usageKey = `daily_usage_${today}`;
        const currentUsage = this.checkDailyUsage();
        localStorage.setItem(usageKey, (currentUsage + 1).toString());
    },
    
    canUseSystem(isPaidMember) {
        if (isPaidMember) return true;
        return this.checkDailyUsage() < 5;
    }
};
        
        const LoginManager = {
            // Line Login Ë®≠ÂÆö
            LINE_CHANNEL_ID: '2008218944',  // ‚ö†Ô∏è Ë®òÂæóÊõøÊèõ
            LINE_CALLBACK_URL: 'https://nickleo9.github.io/GenAI/login-callback.html',
            
            // Supabase Google Login Ë®≠ÂÆö (Êñ∞Â¢û)
            // *** Ë´ãÁ¢∫‰øùÊÇ®Â∑≤Á∂ìÂ∞áÈÄô‰∫õ‰Ωî‰ΩçÁ¨¶ÊõøÊèõÁÇ∫ÊÇ®ÁöÑÁúüÂØ¶Â∞àÊ°àÂÄº ***
            SUPABASE_URL: 'https://naftwmajxuoauokuwpaz.supabase.co', // ÊÇ®ÁöÑ Supabase Â∞àÊ°à URL
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hZnR3bWFqeHVvYXVva3V3cGF6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5OTgxNTgsImV4cCI6MjA3NjU3NDE1OH0.zf-eKQVC5PCFFC_ZucGNbFsc8n4627rRxZQ2A0S4FM4', // ÊÇ®ÁöÑ Supabase Anon Key

            // n8n Webhook URL
            N8N_WEBHOOK_URL: 'https://nickleo9.zeabur.app/webhook/line-login',  // ‚ö†Ô∏è Ë®òÂæóÊõøÊèõ


                async checkMemberStatus(userId) {
        try {
            const response = await fetch('https://nickleo9.zeabur.app/webhook/check-member-status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userId })
            });
            return await response.json();
        } catch (error) {
            return { isPaid: false, memberLevel: 'ÂÖçË≤ªÊúÉÂì°' };
        }
    },
            
            // ÂàùÂßãÂåñ
            init() {
                this.attachEventListeners();
                this.checkLoginStatus();
            },

            
            
            // Á∂ÅÂÆö‰∫ã‰ª∂
            attachEventListeners() {
                // Line ÁôªÂÖ•ÊåâÈàï
                const lineLoginBtn = document.getElementById('line-login-btn');
                if (lineLoginBtn) {
                    lineLoginBtn.addEventListener('click', () => this.lineLogin());
                }
                
                // Â∞éËà™Ê¨ÑÁôªÂÖ•ÊåâÈàï
                const navLoginBtn = document.getElementById('nav-login-btn');
                if (navLoginBtn) {
                    navLoginBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        // ÈªûÊìäÂ∞éËà™Ê¨ÑÁôªÂÖ•ÊôÇÔºåË∑≥ËΩâÂà∞ÁôªÂÖ•ÂçÄÂ°ä
                        document.getElementById('login-section').scrollIntoView({ behavior: 'smooth' });
                    });
                }
                
                // Google ÁôªÂÖ•ÊåâÈàï (ÂØ¶‰Ωú Google Login)
                const googleLoginBtn = document.getElementById('google-login-btn');
                if (googleLoginBtn) {
                    googleLoginBtn.addEventListener('click', () => this.googleLogin());
                }
                
                // ÁôªÂá∫ÊåâÈàï
                document.querySelectorAll('[id$="logout-btn"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.logout();
                    });
                });
            },
            
            // Line ÁôªÂÖ•
            lineLogin() {
                const state = this.generateRandomString(32);
                const nonce = this.generateRandomString(32);
                
                // ÂÑ≤Â≠ò state Áî®ÊñºÈ©óË≠â
                localStorage.setItem('line_login_state', state);
                
                // Âª∫Á´ã Line Login URL
                const lineLoginUrl = `https://access.line.me/oauth2/v2.1/authorize?` +
                    `response_type=code` +
                    `&client_id=${this.LINE_CHANNEL_ID}` +
                    `&redirect_uri=${encodeURIComponent(this.LINE_CALLBACK_URL)}` +
                    `&state=${state}` +
                    `&scope=profile%20openid%20email` +
                    `&nonce=${nonce}` +
                    `&prompt=consent`; 
                
                console.log('üîó Ë∑≥ËΩâÂà∞ Line ÁôªÂÖ•È†ÅÈù¢...');
                window.location.href = lineLoginUrl;
            },
            
            // Google ÁôªÂÖ• (Êñ∞Â¢û)
            googleLogin() {
                // Áî±ÊñºÁî®Êà∂Â∑≤Á∂ìÊâãÂãïÂ°´ÂØ´‰∫ÜÊ≠£Á¢∫ÁöÑ URL Âíå KEYÔºåÊàëÂÄëÁõ¥Êé•ÁßªÈô§ÈåØË™§Ê™¢Êü•
                // ‰ª•‰æøËÆìÁôªÂÖ•Á®ãÂ∫èÈ†ÜÂà©ÂïüÂãï
                
                try {
                    // Supabase ÁöÑ Google OAuth URL
                    const redirectUrl = `${this.SUPABASE_URL}/auth/v1/authorize?` +
                        `provider=google&` +
                        // Á¢∫‰øùÂõûË™ø URL ÊåáÂêëÊàëÂÄëÂª∫Á´ãÁöÑ google-callback.html
                        `redirect_to=${encodeURIComponent(window.location.origin + '/GenAI/google-callback.html')}`;
                    
                    iPASQuizApp.showAlert('Ê≠£Âú®Ë∑≥ËΩâ Google ÁôªÂÖ•...', 'info');
                    window.location.href = redirectUrl;
                } catch (error) {
                    console.error('Google ÁôªÂÖ•ÈåØË™§:', error);
                    iPASQuizApp.showAlert('Google ÁôªÂÖ•ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶', 'error');
                }
            },
            
            // Ê™¢Êü•ÁôªÂÖ•ÁãÄÊÖã (Êõ¥Êñ∞ÔºåÊ™¢Êü• Google/General ÂÑ™ÂÖà)
            checkLoginStatus() {
                // 1. Ê™¢Êü• Google/General ÁôªÂÖ• (Áî± google-callback.html ÂÑ≤Â≠òÔºåÂÑ™ÂÖà)
                const generalUserData = localStorage.getItem('user_data');
                // 2. Ê™¢Êü• Line ÁôªÂÖ• (ÂéüÊúâÁöÑ ipas_user_data)
                const lineUserData = localStorage.getItem('ipas_user_data');
                
                let user = null;
                
                if (generalUserData) {
                    try {
                        user = JSON.parse(generalUserData);
                        user.login_type = user.login_type || 'google'; // Á¢∫‰øùÊúâ login_type
                        this.showUserInfo(user);
                        console.log('‚úÖ Áî®Êà∂Â∑≤ÁôªÂÖ• (General/Google):', user.name || user.email);
                        return;
                    } catch (error) {
                        console.error('‚ùå General Áî®Êà∂Ë≥áÊñôËß£ÊûêÂ§±Êïó:', error);
                        localStorage.removeItem('user_data');
                    }
                } else if (lineUserData) {
                     try {
                        user = JSON.parse(lineUserData);
                        user.login_type = 'line'; // Ê®ôË®òÁÇ∫ Line ÁôªÂÖ•
                        this.showUserInfo(user);
                        console.log('‚úÖ Áî®Êà∂Â∑≤ÁôªÂÖ• (Line):', user.displayName);
                        return;
                    } catch (error) {
                        console.error('‚ùå Line Áî®Êà∂Ë≥áÊñôËß£ÊûêÂ§±Êïó:', error);
                        localStorage.removeItem('ipas_user_data');
                    }
                }
                
                // Êú™ÁôªÂÖ•
                this.showLoginButton();
            },
     
            // È°ØÁ§∫Áî®Êà∂Ë≥áË®ä (Êõ¥Êñ∞ÔºåÂÖºÂÆπ Line Âíå Google ÁöÑË≥áÊñôÁµêÊßã)
            showUserInfo(user) {

                console.log('‚úÖ showUserInfo ÂáΩÂºèÂ∑≤ÂïüÂãïÔºåÁî®Êà∂Âêç:', user.displayName || user.name);
                // Èö±ËóèÁôªÂÖ•ÂçÄÂ°ä
                const loginSection = document.getElementById('login-section');
                if (loginSection) loginSection.classList.add('d-none');
                
                const loginNavItem = document.getElementById('login-nav-item');
                if (loginNavItem) loginNavItem.classList.add('d-none');
                
                // Ê±∫ÂÆöÈ°ØÁ§∫ÂêçÁ®±„ÄÅÈ†≠ÂÉè„ÄÅÁôªÂÖ•ÊñπÂºè
                const displayName = user.displayName || user.name || user.email || '‰ΩøÁî®ËÄÖ';
                const pictureUrl = user.pictureUrl || user.avatar ;
                const loginType = user.login_type === 'google' ? 'Google' : 'Line';
                const memberLevel = user.member_level || 'ÂÖçË≤ªÊúÉÂì°';
                
                // È°ØÁ§∫Áî®Êà∂Ë≥áË®äÂçÄÂ°ä
                const userWelcome = document.getElementById('user-welcome');
                if (userWelcome) {
                    userWelcome.classList.remove('d-none');
                    document.getElementById('user-avatar').src = pictureUrl;
                    document.getElementById('user-name').textContent = displayName;
                    document.getElementById('login-method').textContent = loginType;
                    
                    const lastLogin = new Date().toLocaleString('zh-TW');
                    document.getElementById('last-login').textContent = lastLogin;
                    
                    // È°ØÁ§∫ÊúÉÂì°Á≠âÁ¥ö
                    const levelSpan = document.getElementById('user-level-badge'); 
                    if (levelSpan) {
                        levelSpan.textContent = memberLevel;
                        levelSpan.className = `badge ${memberLevel.includes('‰ªòË≤ª') ? 'bg-warning text-dark' : 'bg-primary'} ms-2`
                    }
                }
                
                // Â∞éËà™Ê¨ÑÈ°ØÁ§∫Áî®Êà∂Ë≥áË®ä
                const userNavItem = document.getElementById('user-nav-item');
                if (userNavItem) {
                    userNavItem.classList.remove('d-none');
                    document.getElementById('nav-user-avatar').src = pictureUrl;
                    document.getElementById('nav-user-name').textContent = displayName;
                }

                   // üî• Êñ∞Â¢û:È°ØÁ§∫/Èö±ËóèÂçáÁ¥öÊåâÈàïÁöÑÈÇèËºØ
    const isPaid = memberLevel.includes('‰ªòË≤ª');
    
    // ÂèñÂæóÊâÄÊúâÂçáÁ¥öÁõ∏ÈóúÂÖÉÁ¥†
    const upgradeBtnLarge = document.getElementById('upgrade-btn-large');
    const freeMemberNotice = document.getElementById('free-member-notice');
    const navUpgradeItem = document.getElementById('nav-upgrade-item');
    
    if (!isPaid) {
        // ÂÖçË≤ªÊúÉÂì°:È°ØÁ§∫ÊâÄÊúâÂçáÁ¥öÂÖ•Âè£
        if (upgradeBtnLarge) upgradeBtnLarge.style.display = 'inline-block';
        if (freeMemberNotice) freeMemberNotice.style.display = 'block';
        if (navUpgradeItem) navUpgradeItem.style.display = 'block';
    } else {
        // ‰ªòË≤ªÊúÉÂì°:Èö±ËóèÊâÄÊúâÂçáÁ¥öÂÖ•Âè£
        if (upgradeBtnLarge) upgradeBtnLarge.style.display = 'none';
        if (freeMemberNotice) freeMemberNotice.style.display = 'none';
        if (navUpgradeItem) navUpgradeItem.style.display = 'none';
    }
            },
            
            
            // È°ØÁ§∫ÁôªÂÖ•ÊåâÈàï
            showLoginButton() {
                const loginSection = document.getElementById('login-section');
                if (loginSection) loginSection.classList.remove('d-none');
                
                const loginNavItem = document.getElementById('login-nav-item');
                if (loginNavItem) loginNavItem.classList.remove('d-none');
                
                const userWelcome = document.getElementById('user-welcome');
                if (userWelcome) userWelcome.classList.add('d-none');
                
                const userNavItem = document.getElementById('user-nav-item');
                if (userNavItem) userNavItem.classList.add('d-none');
            },
            
            // ÁôªÂá∫ (Êõ¥Êñ∞ÔºåÁßªÈô§ÊâÄÊúâÁî®Êà∂Êï∏Êìö)
            logout() {
                if (confirm('Á¢∫ÂÆöË¶ÅÁôªÂá∫ÂóéÔºü\nÊÇ®ÁöÑÂ≠∏ÁøíÈÄ≤Â∫¶Â∞á‰øùÂ≠òÂú®Èõ≤Á´Ø„ÄÇ')) {
                    localStorage.removeItem('ipas_user_data'); // Line ËàäÊï∏Êìö
                    localStorage.removeItem('user_data'); // Google/General Êñ∞Êï∏Êìö
                    console.log('üëã Áî®Êà∂Â∑≤ÁôªÂá∫');
                    location.reload();
                }
            },
            
            // ÁîüÊàêÈö®Ê©üÂ≠ó‰∏≤
            generateRandomString(length) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let result = '';
                for (let i = 0; i < length; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            }
        };
        
        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñÁôªÂÖ•ÁÆ°ÁêÜ
        document.addEventListener('DOMContentLoaded', () => {
            LoginManager.init();
        });
// üî• ‰ªòË≤ªÂçáÁ¥öÂäüËÉΩ JavaScript START

// ÊâìÈñãÂçáÁ¥öÊ®°ÊÖãÊ°Ü
function openUpgradeModal() {
    const modal = new bootstrap.Modal(document.getElementById('upgrade-modal'));
    modal.show();
    console.log('üìä Áî®Êà∂ÈªûÊìäÂçáÁ¥öÊåâÈàï');
}

// È°ØÁ§∫ÂäüËÉΩÈéñÂÆöÊ®°ÊÖãÊ°Ü
function showFeatureLockedModal() {
    const modal = new bootstrap.Modal(document.getElementById('feature-locked-modal'));
    modal.show();
    console.log('üîí Áî®Êà∂ÂòóË©¶‰ΩøÁî®‰ªòË≤ªÂäüËÉΩ');
}

// ÈóúÈñâÊ®°ÊÖãÊ°Ü
function closeModal(modalId) {
    const modalElement = document.getElementById(modalId);
    const modal = bootstrap.Modal.getInstance(modalElement);
    if (modal) modal.hide();
}

// ÈÅ∏ÊìáÊñπÊ°à
function selectPlan(planType) {
    const plans = {
        monthly: {
            name: 'ÊúàË≤ªÊúÉÂì°',
            price: 199,
            duration: '1ÂÄãÊúà'
        },
        yearly: {
            name: 'Âπ¥Ë≤ªÊúÉÂì°',
            price: 1999,
            duration: '12ÂÄãÊúà'
        }
    };
    
    const selectedPlan = plans[planType];
    
    console.log('üõí ÈÅ∏ÊìáÊñπÊ°à:', selectedPlan);
    
    // ÈóúÈñâÊ®°ÊÖãÊ°Ü
    closeModal('upgrade-modal');
    
    // È°ØÁ§∫ÊèêÁ§∫
    iPASQuizApp.showAlert(`‚úÖ ÊÇ®ÈÅ∏Êìá‰∫Ü ${selectedPlan.name} ($${selectedPlan.price})
Á®çÂæåÂ∞áÂ∞éÂêë‰ªòÊ¨æÈ†ÅÈù¢...`, 'success');
    
    // TODO: ÂØ¶Èöõ‰∏äÁ∑öÊôÇ,Â∞éÂêëÁ∂†ÁïåÈáëÊµÅ
    // window.location.href = '/payment?plan=' + planType;
    
    // ÁèæÂú®ÂÖàÂ∞éÂêë‰Ω†ÁöÑËÅØÁµ°È†ÅÈù¢
    setTimeout(() => {
        window.open('https://portaly.cc/zn.studio', '_blank');
    }, 2000);
}

// Ê™¢Êü•ÂäüËÉΩÊ¨äÈôê(Áî®ÊñºÈéñÂÆö‰ªòË≤ªÂäüËÉΩ)
function checkFeatureAccess(feature) {
    const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
    const lineData = JSON.parse(localStorage.getItem('ipas_user_data') || '{}');
    const memberLevel = userData.member_level || lineData.memberLevel || 'ÂÖçË≤ªÊúÉÂì°';
    
    // ‰ªòË≤ªÂäüËÉΩÂàóË°®
    const paidFeatures = ['exam', 'export', 'cloud-sync', 'ai-analysis'];
    
    if (paidFeatures.includes(feature) && !memberLevel.includes('‰ªòË≤ª')) {
        // È°ØÁ§∫ÂäüËÉΩÈéñÂÆöÊ®°ÊÖãÊ°Ü
        showFeatureLockedModal();
        return false;
    }
    return true;
}

// üî• ‰ªòË≤ªÂçáÁ¥öÂäüËÉΩ JavaScript END

        
    </script>
    <!-- ‚ú® Êñ∞Â¢ûÔºöÁôªÂÖ•ÂäüËÉΩ JavaScript END -->

<!-- üî• ÂäüËÉΩÈéñÂÆöÊ®°ÊÖãÊ°Ü -->
<div class="modal fade" id="feature-locked-modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border: 3px solid #f5576c;">
            <div class="modal-header bg-gradient-premium text-white">
                <h5 class="modal-title">
                    <i class="fas fa-lock me-2"></i>VIP Â∞àÂ±¨ÂäüËÉΩ
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center p-4">
                <div class="mb-4">
                    <i class="fas fa-crown" style="font-size: 4rem; color: #f5576c;"></i>
                </div>
                <h4 class="mb-3">Ê≠§ÂäüËÉΩÈúÄË¶ÅÂçáÁ¥öÁÇ∫‰ªòË≤ªÊúÉÂì°</h4>
                <p class="text-muted mb-4">ÂçáÁ¥öÂæåÂç≥ÂèØËß£Èéñ:</p>
                
                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Ê®°Êì¨ËÄÉË©¶Ê®°Âºè
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Èõ≤Á´ØÂêåÊ≠•ÈÄ≤Â∫¶
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            ÈåØÈ°åÈõÜÂåØÂá∫
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            AI Âº±ÈªûÂàÜÊûê
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Âç≥ÊôÇÈ°åÁõÆËß£Êûê
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="feature-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            ÂÆåÊï¥Â≠∏ÁøíÂàÜÊûê
                        </div>
                    </div>
                </div>
                
                <div class="price-tag mb-4">
                    <div class="h2 mb-0">
                        <span class="text-muted" style="text-decoration: line-through; font-size: 1rem;">$2,388</span>
                        <span class="text-danger ms-2">$1,999</span>
                        <span class="text-muted" style="font-size: 1rem;">/Âπ¥</span>
                    </div>
                    <small class="text-success">
                        <i class="fas fa-tags me-1"></i>ÈôêÊôÇÂÑ™ÊÉ†,ÁúÅ $390
                    </small>
                </div>
                
                <button class="btn btn-gradient-premium btn-lg w-100 mb-2" onclick="closeModal('feature-locked-modal'); openUpgradeModal();">
                    <i class="fas fa-crown me-2"></i>Á´ãÂç≥ÂçáÁ¥ö VIP
                </button>
                <button class="btn btn-outline-secondary w-100" data-bs-dismiss="modal">
                    Á®çÂæåÂÜçË™™
                </button>
            </div>
        </div>
    </div>
</div>

<!-- üî• ÂçáÁ¥öÊñπÊ°àÊ®°ÊÖãÊ°Ü -->
<div class="modal fade" id="upgrade-modal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-gradient-premium text-white">
                <h4 class="modal-title">
                    <i class="fas fa-crown me-2"></i>ÂçáÁ¥ö‰ªòË≤ªÊúÉÂì°,Ëß£ÈéñÂÆåÊï¥ÂäüËÉΩ
                </h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row g-4">
                    <!-- ÂÖçË≤ªÊñπÊ°à -->
                    <div class="col-md-4">
                        <div class="card h-100 pricing-card">
                            <div class="card-body text-center">
                                <h5 class="mb-3">ÂÖçË≤ªÊúÉÂì°</h5>
                                <div class="h2 mb-4">$0</div>
                                <ul class="list-unstyled text-start">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        ÁÑ°ÈôêÊ¨°Á∑¥Áøí
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        4 ÂÄãÈ°åÂ∫´
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Ê®ôÊ∫ñÁ∑¥ÁøíÊ®°Âºè
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Êú¨Âú∞ÈåØÈ°åË®òÈåÑ
                                    </li>
                                    <li class="mb-2 text-muted">
                                        <i class="fas fa-times text-danger me-2"></i>
                                        Ê®°Êì¨ËÄÉË©¶Ê®°Âºè
                                    </li>
                                    <li class="mb-2 text-muted">
                                        <i class="fas fa-times text-danger me-2"></i>
                                        Èõ≤Á´ØÂêåÊ≠•
                                    </li>
                                    <li class="mb-2 text-muted">
                                        <i class="fas fa-times text-danger me-2"></i>
                                        AI ÂàÜÊûêÂ†±Âëä
                                    </li>
                                </ul>
                                <button class="btn btn-outline-secondary w-100 mt-3" disabled>
                                    ÁõÆÂâçÊñπÊ°à
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊúàË≤ªÊñπÊ°à -->
                    <div class="col-md-4">
                        <div class="card h-100 border-warning pricing-card">
                            <div class="card-body text-center">
                                <h5 class="mb-3">ÊúàË≤ªÊúÉÂì°</h5>
                                <div class="h2 mb-4">
                                    $199
                                    <small class="text-muted">/Êúà</small>
                                </div>
                                <ul class="list-unstyled text-start">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        <strong>ÂÖçË≤ªÊúÉÂì°ÂÖ®ÈÉ®ÂäüËÉΩ</strong>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Ê®°Êì¨ËÄÉË©¶Ê®°Âºè
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Èõ≤Á´ØÂêåÊ≠•ÈÄ≤Â∫¶
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        ÈåØÈ°åÈõÜÂåØÂá∫ (TXT)
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Âç≥ÊôÇÈ°åÁõÆËß£Êûê
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        ÂÆåÊï¥Â≠∏ÁøíÁµ±Ë®à
                                    </li>
                                    <li class="mb-2 text-muted">
                                        <i class="fas fa-times text-danger me-2"></i>
                                        AI Âº±ÈªûÂàÜÊûê
                                    </li>
                                </ul>
                                <button class="btn btn-warning w-100 mt-3" onclick="selectPlan('monthly')">
                                    <i class="fas fa-shopping-cart me-2"></i>ÈÅ∏ÊìáÊúàË≤ªÊñπÊ°à
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Âπ¥Ë≤ªÊñπÊ°à (Êé®Ëñ¶) -->
                    <div class="col-md-4">
                        <div class="card h-100 border-danger shadow-lg pricing-card recommended-card">
                            <div class="ribbon">
                                <span>ÊúÄÂàíÁÆó</span>
                            </div>
                            <div class="card-body text-center">
                                <h5 class="mb-3 text-danger">
                                    <i class="fas fa-star me-1"></i>
                                    Âπ¥Ë≤ªÊúÉÂì°
                                </h5>
                                <div class="mb-2">
                                    <span class="text-muted" style="text-decoration: line-through;">
                                        $2,388
                                    </span>
                                </div>
                                <div class="h2 mb-1 text-danger">
                                    $1,999
                                    <small class="text-muted">/Âπ¥</small>
                                </div>
                                <div class="mb-4">
                                    <span class="badge bg-success">ÁúÅ $390</span>
                                    <span class="badge bg-info ms-1">ÊØèÊúàÂÉÖ $167</span>
                                </div>
                                <ul class="list-unstyled text-start">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        <strong>ÊúàË≤ªÊúÉÂì°ÂÖ®ÈÉ®ÂäüËÉΩ</strong>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        <strong>AI Âº±ÈªûÂàÜÊûêÂ†±Âëä</strong>
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        Â∞àÂ±¨Â≠∏ÁøíÊåáÂçó
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        ÈåØÈ°åÈõÜÂåØÂá∫ (PDF)
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        ÂÑ™ÂÖàÂÆ¢ÊúçÊîØÊè¥
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        ÁµÇË∫´Êõ¥Êñ∞È°åÂ∫´
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-star text-warning me-2"></i>
                                        Á§æÁæ§Áç®ÂÆ∂Ë≥áÊ∫ê
                                    </li>
                                </ul>
                                <button class="btn btn-danger w-100 mt-3 btn-lg" onclick="selectPlan('yearly')">
                                    <i class="fas fa-crown me-2"></i>Á´ãÂç≥ÂçáÁ¥ö VIP
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰ªòÊ¨æÊñπÂºèË™™Êòé -->
                <div class="mt-4 p-3 bg-light rounded">
                    <h6>
                        <i class="fas fa-credit-card me-2"></i>‰ªòÊ¨æÊñπÂºè
                    </h6>
                    <div class="d-flex flex-wrap gap-3 mb-3">
                        <span class="badge bg-primary">‰ø°Áî®Âç°</span>
                        <span class="badge bg-success">Line Pay</span>
                        <span class="badge bg-info">Ë∂ÖÂïÜ‰ª£Á¢º</span>
                        <span class="badge bg-warning text-dark">ATM ËΩâÂ∏≥</span>
                    </div>
                    <small class="text-muted">
                        ‰ΩøÁî®Á∂†ÁïåÈáëÊµÅ,ÂÆâÂÖ®Êúâ‰øùÈöú
                    </small>
                </div>
                
                <!-- ‰øùË≠âË™™Êòé -->
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="fas fa-shield-alt me-1"></i>
                        7 Â§©ÁÑ°Ê¢ù‰ª∂ÈÄÄÊ¨æ‰øùË≠â | 
                        <i class="fas fa-lock me-1"></i>
                        SSL Âä†ÂØÜ‰øùË≠∑ |
                        <i class="fas fa-headset me-1"></i>
                        Â∞àÊ•≠ÂÆ¢ÊúçÊîØÊè¥
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>


    
</body>
</html>





